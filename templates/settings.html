<!DOCTYPE html>
<html>
<head>
    <title>Settings - SimpleScribeVA</title>
    <link rel="icon" type="image/x-icon" href="/static/icon.ico">
    <link rel="stylesheet" href="/static/style.css">
    <style>
        /* Additional styles for cleaner layout */
        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }

        .button-row {
            margin-top: 16px;
        }

        .button-row button {
            margin-right: 8px;
        }

        .module-inputs {
        display: flex;
        flex-direction: column;
        gap: 10px;
        background: #f3f6fa;
        border-radius: 8px;
        padding: 1em 1.2em;
        margin-top: 0.5em;
        border: 1px solid #e3e8ee;
        }

        .module-inputs label {
        display: flex;
        align-items: center;
        font-weight: 500;
        font-size: 1em;
        cursor: pointer;
        padding: 2px 0;
        }

        .module-inputs label:hover {
        background: #eaf1fb;
        border-radius: 4px;
        }

        .module-inputs input[type="checkbox"] {
        accent-color: #1976d2;
        margin-right: 0.7em;
        width: 1.1em;
        height: 1.1em;
        }

        .module-section {
            margin-bottom: 32px;
        }

        /* Section containers */
        .module-section {
            background: #f8fafc;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            border: 1px solid #e3e8ee;
            padding: 2rem 1.5rem 1.5rem 1.5rem;
            margin-bottom: 36px;
            position: relative;
        }

        /* Section headers with icons */
        .module-section h3 {
            display: flex;
            align-items: center;
            font-size: 1.25em;
            margin-top: 0;
            margin-bottom: 1.2em;
            font-weight: 600;
            letter-spacing: 0.01em;
        }

        .module-section.patient-instructions h3::before {
            content: "üíä";
            margin-right: 0.5em;
            font-size: 1.2em;
        }

        .module-section.templates h3::before {
            content: "üìù";
            margin-right: 0.5em;
            font-size: 1.2em;
        }

        .module-section.modules h3::before {
            content: "üß©";
            margin-right: 0.5em;
            font-size: 1.2em;
        }

        /* Optional: accent border on left */
        .module-section.templates {
            border-left: 5px solid #1976d2;
            background: #f3f8fd; /* subtle blue */
        }
        .module-section.modules {
            border-left: 5px solid #43a047;
            background: #f6fcf7; /* subtle green */
        }
        .module-section.patient-instructions {
            border-left: 5px solid #8e24aa; /* purple accent */
            background: #f9f6fc; /* subtle purple */
        }

        /* NEW: Dot-phrases orange themed block */
        .module-section.dotphrases {
            border-left: 5px solid #fb8c00; /* orange accent */
            background: #fff7ed; /* subtle orange */
        }
        .module-section.dotphrases h3::before {
            content: "üî∏";
            margin-right: 0.5em;
            font-size: 1.2em;
        }
        .dotphrase-box { background:#fff; border:1px solid #ffd7a8; padding:12px; border-radius:8px; margin:8px 0; }
        .dotphrase-box ul { margin: 8px 0 0 18px; }
        .dotphrase-box li code { background:#fff3e0; padding:2px 6px; border-radius:4px; }

        /* Tidy Archives block: reduce whitespace and arrange neatly */
        .module-section.archives {
            border-left: 5px solid #90a4ae; /* blue-grey */
            background: #f7f9fb;
            padding: 1.2rem 1rem 1rem 1rem; /* tighter */
        }
        .module-section.archives .form-group { margin-bottom: 10px; }
        .archive-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px 18px; align-items: start; }
        .archive-grid label { font-weight: 500; margin-bottom: 4px; }
        .archive-grid small { color:#555; display:block; margin-top:4px; line-height:1.3; }

        .dotphrase-link { color:#1976d2; text-decoration:underline; cursor:pointer; }
        .dotphrase-box { display:none; background:#f9fbff; border:1px solid #e3e8ee; padding:12px; border-radius:8px; margin:12px 0; }
        .dotphrase-box ul { margin: 8px 0 0 18px; }
        .dotphrase-box li code { background:#eef4ff; padding:2px 6px; border-radius:4px; }
    </style>
</head>
<body>
    <div class="global-top-bar">
        <div class="left-controls">
            <a href="/" class="header-title">SimpleScribeVA</a>
            <button id="recordBtn" class="start-button">Start Recording</button>
        </div>
        <div class="right-controls">
            <a href="/scribe" title="Scribe">üìù</a>
            <a href="/explore" title="Explore Chart Data">üîç</a>
            <a href="/archive" title="Transcripts">üìÅ</a>
            <a href="/settings" title="Settings">‚öôÔ∏è</a>
            <button id="hamburgerBtn" class="hamburger-btn" aria-label="Menu">&#9776;</button>
        </div>
    </div>
    <div id="mobileMenu" class="mobile-menu">
        <a href="/scribe">üìù Scribe</a>
        <a href="/explore">üîç Explore</a>
        <a href="/archive">üìÅ Archive</a>
        <a href="/settings">‚öôÔ∏è Settings</a>
        <hr class="mobile-menu-separator">
        <a href="#" class="end-session-link" onclick="exitApp();return false;" title="Exit">üö™ Exit</a>
    </div>
    <div class="container">
        <h2>Settings (Customize Instructions, Prompts and Modules)</h2>

        <!-- Dot-Phrases Reference Section -->
        <div class="module-section dotphrases">
            <h3>Dot-Phrases Reference</h3>
            <p style="margin-top:-4px;color:#5d4037;">Use these inline placeholders in prompts or notes. They will be replaced with current patient data when available.</p>
            <div id="dotphraseBox" class="dotphrase-box" style="display:block;">
                <ul id="dotphraseList"></ul>
            </div>
        </div>

        <!-- Archives Controls Section (tidied) -->
        <div class="module-section archives">
            <h3>Archive Settings</h3>
            <div class="archive-grid">
                <div class="form-group">
                    <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-weight:600;">
                        <input type="checkbox" id="toggleAutoSaveArchives">
                        Auto-save current session to Archives (every 5 seconds)
                    </label>
                    <small>When enabled, selecting a new patient will create an archive like "8-27-25 at 1025 with BOB JONES" and auto-save every 5 seconds.</small>
                </div>
                <div class="form-group">
                    <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-weight:600;">
                        <input type="checkbox" id="toggleAutoDeleteArchives10d">
                        Auto-delete Archives after 10 Days
                    </label>
                    <small>When enabled, archives older than 10 days are removed automatically.</small>
                </div>
            </div>
        </div>

        <!-- Patient Instructions Prompt Section -->
        <div class="module-section patient-instructions">
            <h3>Manage Patient Instructions Prompt</h3>
            <div class="form-group">
                <label for="patientInstructionsPromptText">Prompt Content</label>
                <textarea id="patientInstructionsPromptText" placeholder="Enter your patient instructions prompt here..." rows="6"></textarea>
            </div>
            <div class="button-row">
                <button id="savePatientInstructionsPromptBtn">Save Prompt</button>
                <button id="clearPatientInstructionsPromptBtn">Clear</button>
                <button id="resetPatientInstructionsPromptBtn" type="button">Reset to Default</button>
                <span id="patientInstructionsPromptStatus" style="margin-left:12px;color:green;"></span>
            </div>
        </div>

        <!-- Custom Prompt Templates Section -->
        <div class="module-section templates">
            <h3>Manage Custom Prompt Templates</h3>
            <div style="text-align:right; margin-bottom: 0.5em;">
                <a href="https://apps.gov.powerapps.us/play/e/default-e95f1b23-abaf-45ee-821d-b7ab251ab3bf/a/34ceda55-1a9a-415f-afde-052c61f566fe?tenantId=e95f1b23-abaf-45ee-821d-b7ab251ab3bf#" target="_blank" style="font-size:0.95em; color:#1976d2; text-decoration:underline; opacity:0.7;">VA Prompt Library</a>
            </div>
            <div class="form-group">
                <label for="customTemplateDropdown">Select Template</label>
                <select id="customTemplateDropdown">
                    <option value="">-- Choose a template --</option>
                </select>
            </div>
            <div class="form-group">
                <label for="customTemplateName">Template Name</label>
                <input type="text" id="customTemplateName" placeholder="Enter the name of the template">
            </div>
            <div class="form-group">
                <label for="customTemplateText">Template Content</label>
                <textarea id="customTemplateText" placeholder="Enter your custom prompt here..." rows="6"></textarea>
            </div>
            <div class="button-row">
                <button onclick="saveCustomTemplate()">Save Template</button>
                <button onclick="deleteCustomTemplate()">Delete Template</button>
                <button onclick="clearCustomTemplateEditor()">Clear</button>
            </div>
        </div>

        <!-- Smart Modules Section -->
        <div class="module-section modules">
            <h3>Manage Smart Modules</h3>
            <div class="form-group">
                <label for="moduleDropdown">Select Module</label>
                <select id="moduleDropdown">
                    <option value="">-- Choose a module --</option>
                </select>
            </div>
            <div class="button-row">
                <button onclick="loadModuleList()">Refresh Module List</button>
            </div>
            <hr>
            <fieldset>
                <legend>Module Details</legend>
                <div class="form-group">
                    <label for="moduleFileName">Filename</label>
                    <input type="text" id="moduleFileName" placeholder="Enter the filename (e.g., module.txt)">
                </div>
                <div class="form-group">
                    <label for="moduleTitle">Title</label>
                    <input type="text" id="moduleTitle" placeholder="Enter the module title">
                </div>
                <div class="form-group">
                    <label for="moduleOutput">Output</label>
                    <input type="text" id="moduleOutput" placeholder="Name of output will be same as filename" readonly>
                </div>
                <div class="form-group">
                    <label for="moduleChain"><i>Optional:</i> Nesting modules (e.g. for each problem returned -> find treatments -> list meds)</label>
                    <input type="text" id="moduleChain" placeholder="Add modules to the chain. Use commas for multiple. e.g. 'findTreatments,listMeds'">
                </div>
                <div class="form-group">
                    <label>Inputs</label>
                    <div class="module-inputs" id="moduleInputs">
                        <label><input type="checkbox" value="chunkText"><i>Explore:&nbsp;</i>  Chart data</label>
                        <label><input type="checkbox" value="exploreGptAnswer"><i>Explore:&nbsp;</i>  Query answer</label>
                        <label><input type="checkbox" value="transcript"><i>Scribe:&nbsp;&nbsp;</i>  Visit transcript</label>
                        <label><input type="checkbox" value="visitNotes"><i>Scribe:&nbsp;&nbsp;</i>  Visit notes</label>
                        <label><input type="checkbox" value="feedbackReply"><i>Scribe:&nbsp;&nbsp;</i>  Note created today</label>
                        <label><input type="checkbox" value="promptTemplate"><i>Scribe:&nbsp;&nbsp;</i>  Note prompt</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="moduleQuery">Search for the most relevant data to send <i>(needed only with Chart Data)</i></label>
                    <textarea id="moduleQuery" placeholder="Enter your clinical question, to help narrow data..." rows="4"></textarea>
                </div>
                <div class="form-group">
                    <label for="moduleAIPrompt">AI Prompt</label>
                    <textarea id="moduleAIPrompt" placeholder="Enter your full prompt for AI..." rows="4"></textarea>
                </div>
                <div class="button-row">
                    <button onclick="saveModule()">Save Module</button>
                    <button onclick="deleteSelectedModule()">Delete</button>
                    <button onclick="clearModuleEditor()">Clear</button>
                </div>
            </fieldset>
        </div>
    </div>
    <script src="/static/SessionManager.js"></script>
    <script src="/static/settings.js"></script>
    <script src="/static/app.js"></script>
</body>
</html>