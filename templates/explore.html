<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Explore Chart Data</title>
    <link rel="icon" type="image/x-icon" href="/static/icon.ico">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="global-top-bar">
        <div class="left-controls">
            <a href="/" class="header-title">SimpleScribeVA</a>
            <button id="recordBtn" class="start-button">Start Recording</button>
            <span id="patientNameDisplay" style="margin-left:24px;font-weight:bold;"></span>
            <button id="selectPatientBtn">Select Patient</button>
        </div>
        <div class="right-controls">
            <button id="endSessionBtn" class="danger-button" onclick="endSession()">End Session</button>
            <a href="/scribe" title="Scribe">📝</a>
            <a href="/explore" title="Explore Chart Data">🔍</a>
            <a href="/archive" title="Transcripts">📁</a>
            <a href="/settings" title="Settings">⚙️</a>
            <button id="hamburgerBtn" class="hamburger-btn" aria-label="Menu">&#9776;</button>
        </div>
    </div>
    <div id="mobileMenu" class="mobile-menu">
        <a href="/scribe">📝 Scribe</a>
        <a href="/explore">🔍 Explore</a>
        <a href="/archive">📁 Archive</a>
        <a href="/settings">⚙️ Settings</a>
        <hr class="mobile-menu-separator">
        <a href="#" class="end-session-link" onclick="endSession();return false;" title="End Session">💾 Save and End</a>
    </div>
</div>
<div class="container">
    <h2>Explore Chart Data</h2>
    <!-- VistA RPC Explorer Module
    <div class="panel" id="vistaRpcExplorerPanel" style="margin-top:32px;">
        <h3>VistA RPC Explorer</h3>
        <label for="rpcNameInput">RPC Name:</label>
        <input type="text" id="rpcNameInput" placeholder="e.g. SDES GET PATIENT DEMOGRAPHICS" style="width:350px;">
        <label for="rpcParamsInput" style="margin-left:12px;">Parameters (JSON array):</label>
        <input type="text" id="rpcParamsInput" placeholder='e.g. [{"string": "12345"}]' style="width:350px;">
        <button id="runRpcBtn">Run RPC</button>
        <pre id="rpcResultBox" style="margin-top:16px; background:#f8f8f8; padding:12px; border-radius:6px; min-height:80px;"></pre>
    </div>  -->
    <div class="side-by-side">
        <!-- LEFT: Chart Data Input/Search/Display -->
        <div class="panel" style="border:none;">
            <h3>Chart Data</h3>
            <div id="dropZone" class="drop-zone">
                <textarea id="chunkText" placeholder="Paste chart text here or drop a PDF file..."></textarea>
                <div class="drop-overlay">
                    <span>Drop PDF here</span>
                </div>
            </div>
            <div class="button-group">
                <button id="exploreChartBtn" onclick="submitChartChunk()">Prepare Data</button>
                <button id="openKeywordModalBtn">Keyword Search</button>
            </div>
            <div id="chunkStatus"></div>
        </div>
        <!-- RIGHT: OpenAI Query/Answer -->
        <div class="panel" style="border:none;">
            <h3>Query Chart</h3>
            <input type="text" 
                   id="exploreSearchBox" 
                   placeholder="Ask a question and press Enter..." 
                   onkeyup="if(event.key === 'Enter') runExploreSearch()">
            <div id="exploreGptAnswer" class="markdown-box"></div>
        </div>
    </div>

    <!-- Add this after your main flex row, before the button-row or at the end of .container -->

    <!-- Labs and Vitals modules -->
    <div style="margin-top:32px;">
        <!-- Vitals Module Only -->
        <div class="panel" id="vitalsModule">
            <h3>Vitals</h3>
            <div id="vitalsChartContainer" style="width:100%;height:340px;min-width:320px;min-height:240px;">Loading vitals chart...</div>
            <div style="margin-top:10px;">
                <label for="vitalTypeSelect">Show vital sign:</label>
                <select id="vitalTypeSelect"></select>
            </div>
        </div>
    </div>

    <div id="dynamicModules" style="margin-top:32px;"></div>
</div>
<div id="exploreSearchResults" style="margin-top:18px;"></div>

<!-- Modal for paginated chart viewing -->
<div id="chartModal">
  <div id="chartModalInner">
    <button id="closeChartModalBtn">&times;</button>

    <!-- Modal header (keep your close button and page label here) -->
    <div style="display:flex;justify-content:space-between;align-items:center;padding:18px 32px 0 32px;">
      <button id="modalPrevBtn">&lt; Prev</button>
      <span id="chartModalPageLabel"></span>
      <button id="modalNextBtn">Next &gt;</button>
    </div>

    <!-- Horizontal page scroller -->
    <div id="chartModalPageScroller"></div>

    <!-- Main content -->
    <div id="chartModalContent"></div>

    <!-- Modal footer: keyword search and match navigation -->
    <div id="chartModalFooter" class="modal-footer">
      <input id="modalKeywordInput" type="text" placeholder="Keyword search..." />
      <span id="modalMatchLabel"></span>
      <button id="prevModalMatchBtn">&lt;</button>
      <button id="nextModalMatchBtn">&gt;</button>
    </div>
  </div>
</div>
<!-- Patient Record Modules: Active Problems, Medications, Labs -->
<div id="patientRecordModules" style="margin-top: 24px;"></div>
<div id="patientRecordDisplay" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; background-color: #f9f9f9;">
    <h3>Patient Record</h3>
    <pre id="patientRecordJson" style="white-space: pre-wrap; word-wrap: break-word;"></pre>
</div>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<!-- ECharts loader and vitals chart integration -->
<script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
<script src="/static/vitals_chart.js"></script>
<script src="/static/SessionManager.js"></script>
<script src="/static/explore.js"></script>
<script src="/static/app.js"></script>
<script src="/static/patient.js"></script>
<script src="/static/selectpatient.js"></script>
</body>
</html>
