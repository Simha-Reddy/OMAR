/* === GLOBAL STYLES === */
:root {
  /* VA palette as default */
  --va-primary: #3a6685;
  --va-primary-dark: #2f526b;
  --va-primary-contrast: #ffffff;
  --va-link: #1a4480;           /* USWDS-like link */
  --va-link-hover: #14345f;

  /* Map brand-blue family to VA colors so legacy usages follow VA by default */
  --brand-blue: var(--va-primary);       /* Global top bar + tables header */
  --brand-blue-dark: var(--va-primary-dark);  /* Slightly darker for borders/shadows */

  /* Original palette: shared neutrals and accents used inline in JS/components */
  --omr-text-strong: #222;
  --omr-text: #333;
  --omr-text-muted: #444;
  --omr-text-soft: #555;
  --omr-text-light: #6c757d;    /* bootstrap-ish muted */
  --omr-gray-300: #d1d5db;      /* light gray border/fill */
  --omr-gray-200: #e5e7eb;      /* divider gray */
  --omr-gray-100: #f3f4f6;      /* light background */
  --omr-white: #ffffff;
  --omr-border: #d1d5db;        /* default border */
  --omr-shadow: rgba(0,0,0,0.18); /* popover shadow */
  --omr-shadow-soft: rgba(0,0,0,0.15);

  --omr-green: #10b981;         /* success/ready (tri-bar on) */
  --omr-green-strong: #27ae60;  /* button hover */
  --omr-red: #e74c3c;           /* danger */
  --omr-red-strong: #b91c1c;    /* strong error text */
  --omr-blue-link: var(--va-link);     /* citations */
  --omr-highlight: #ffe066;     /* keyword highlight */

  /* Semantic tokens â€” set to VA palette by default */
  --color-primary: var(--va-primary);
  --color-primary-dark: var(--va-primary-dark);
  --color-primary-contrast: var(--va-primary-contrast);
  --color-link: var(--omr-blue-link);
  --color-link-hover: #125ea2;
  --color-success: var(--omr-green);
  --color-danger: var(--omr-red);
  --color-muted: var(--omr-text-muted);
  --color-strong: var(--omr-text-strong);
  --color-border: var(--omr-border);
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #e5ecf3;
    margin: 0;
    padding: 20px;
    color: #333;
    padding-top: 60px; /* Space for fixed top bar */
}

/* Add top padding to .container if .global-top-bar is present */
body .container {
    padding-top: 60px;
}

.container {
    max-width: 950px;
    margin: auto;
    background: #ffffffee;
    border-radius: 14px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    padding: 25px 35px;
}

/* Wider container for Explore page */
.container.container-wide {
    max-width: 1600px;
    width: min(96vw, 1600px);
    margin: 0 auto;
    padding-left: 14px;
    padding-right: 14px;
}

/* Prevent middle container from overflowing in 3-col layout */
.explore-grid .container.container-wide { width: 100% !important; max-width: 100% !important; }

.header-bar, .top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-title,
.global-top-bar .header-title {
    color: #fff !important;
    font-size: 2.2em;
    font-style: italic;
    font-weight: 600;
    text-decoration: none;
    line-height: 1;
    display: flex;
    align-items: center;
    height: 100%;
    margin-right: 0;
    padding-left: 0;
}

/* OMAR logo: heavier, no italics, subtle shadow */
.global-top-bar .header-title {
    font-style: normal !important;
    font-weight: 800 !important;
    text-shadow: 0 2px 3px rgba(0,0,0,0.221), 0 6px 16px rgba(0,0,0,0.123);
    letter-spacing: 0.3px;
}

.left-controls, .right-controls {
    display: flex;
    align-items: center;
    gap: 16px;
    flex-shrink: 0;
}

.global-top-bar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
  background: var(--color-primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 32px;
    z-index: 1000;
    box-sizing: border-box;
}

/* Mobile top bar: search icon sizing */
.global-top-bar .mobile-search-btn {
  background: transparent !important;
  border: none !important;
  padding: 0 !important;
  margin: 0 4px 0 0;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  height: 40px;  /* approximate bar control height */
  width: 40px;
  line-height: 1;
}
.global-top-bar .mobile-search-btn .search-icon {
  display: block;
  height: 100%;   /* fill the button height */
  width: auto;    /* preserve aspect ratio */
}
@media (max-width: 900px) {
  .global-top-bar .mobile-search-btn { height: 36px; width: 36px; }
}

/* Centered patient area in the global top bar */
.global-center {
  position: absolute; /* center independent of left/right widths */
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  color: #fff;
  max-width: 44vw;
  min-width: 220px;
  line-height: 1.15;
  cursor: pointer;
  user-select: none;
}
.global-center:focus { outline: 2px solid #aeeaff; border-radius: 6px; }
#patientTopName { font-weight: 700; font-size: 1.05em; letter-spacing: 0.2px; }
#patientTopDetails { font-size: 0.92em; opacity: 0.95; }
/* Keep search input a reasonable size on the right */
.right-controls #patientSearchInput { width: 320px; max-width: 38vw; }

.global-nav,
.global-top-bar .global-nav {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-left: 0;
}

.global-top-bar .global-nav a {
    color: #fff;
    font-size: 2em;
    text-decoration: none;
    border-bottom: 3px solid transparent;
    padding-bottom: 2px;
    transition: border-color 0.2s;
}

.global-top-bar .global-nav a:hover {
    border-bottom: 3px solid #aeeaff;
}

.start-button,
.global-top-bar .start-button,
.global-top-bar .stop-button {
    font-size: 1.1em;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    align-self: center;
    height: 40px;
    box-sizing: border-box;
    white-space: nowrap;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s, color 0.2s;
}

.global-top-bar .start-button {
    margin-left: 16px;
}

.danger-button,
.global-top-bar .danger-button {
    font-size: 1em;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    align-self: center;
    height: 40px;
    box-sizing: border-box;
    white-space: nowrap;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid #e74c3c;
    background-color: white;
    color: #e74c3c;
    transition: background-color 0.2s, color 0.2s, border-color 0.2s;
}

.danger-button:hover,
.global-top-bar .danger-button:hover,
.global-top-bar .danger-button:focus {
    background-color: #e74c3c;
    color: white;
    border-color: #e74c3c;
}

.danger-button:active,
.global-top-bar .danger-button:active {
    background-color: #c0392b;
    border-color: #c0392b;
}

.start-button {
    border: 2px solid #2ecc71;
    background-color: #2ecc71;
    color: white;
    margin-right: 12px;
}

.start-button:hover {
    background-color: #27ae60;
}

.stop-button {
    border: 2px solid #e74c3c;
    background-color: #e74c3c;
    color: white;
    margin-right: 12px;
}

.stop-button:hover {
    background-color: #c0392b;
}

textarea, input[type="text"] {
    font-family: 'Courier New', monospace;
    font-size: 1em;
    padding: 14px;
    border-radius: 10px;
    border: 1px solid #bbb;
    background-color: #fefefe;
    box-sizing: border-box;
    resize: vertical;
}

select {
    font-size: 1em;
    padding: 12px;
    margin-bottom: 20px;
    border-radius: 8px;
    width: 100%;
    border: 1px solid #bbb;
    background-color: #fbfbfb;
    box-sizing: border-box;
}

h2 {
    border-bottom: 1px solid #ddd;
    padding-bottom: 6px;
    margin-top: 20px;
    color: #3498db;
}

/* Two panels side-by-side on desktop, stacked on mobile */
.side-by-side {
    display: grid;
    grid-template-columns: 1fr;
    gap: 16px;
}
@media (min-width: 900px) {
    .side-by-side { grid-template-columns: 1fr 1fr; }
}

.side-by-side > .panel {
    flex: 1 1 0;
    min-width: 320px; /* Prevents panels from getting too small */
    max-width: 48%;   /* Ensures two per row */
    margin-bottom: 24px;
    box-sizing: border-box;
}

.panel h2 {
    margin-top: 0;
}

.panel {
    border: 1px solid #ccc;
    border-radius: 6px;
    padding: 12px 18px;
    background: #fff;
    box-sizing: border-box;
    max-width: 100%;
}

.button-row {
    display: flex;
    gap: 12px;
    margin-top: 10px;
    margin-bottom: 20px;
}

/* === EXPLORE-SPECIFIC STYLES === */
.chunk-entry {
    margin-top: 30px;
}

#chunkText, #chunkLabel {
    width: 100%;
}

#chunkText {
    min-height: 200px; /* Increased from 140px */
    margin-bottom: 8px;
    resize: vertical;
}

.output-block {
    margin-top: 30px;
}

.output-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.markdown-box {
    background: #fefefe;
    border: 0px solid #ccc;
    border-radius: 10px;
    padding: 15px;
    min-height: 80px;
    max-height: 250px;
    overflow-y: auto;
    margin-top: 10px;
    margin: 10px 0;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    background: #f8f9fa;
}

.markdown-body {
    font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, 'Noto Sans', Roboto, 'Liberation Sans', system-ui, sans-serif;
    line-height: 1.6;
    white-space: pre-wrap;
}

.markdown-body h3 {
    color: #2c3e50;
}

.markdown-body ul {
    padding-left: 20px;
}

.selected-patient {
    background: #e0f3ff;
    font-weight: bold;
}

/* Enhanced Patient Search Dropdown Styles */
.patient-dropdown {
    font-family: 'Segoe UI', system-ui, sans-serif;
    font-size: 14px;
    line-height: 1.4;
}

.patient-dropdown .section-header {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    position: sticky;
    top: 0;
    z-index: 1;
}

.patient-dropdown .patient-item {
    transition: background-color 0.15s ease, box-shadow 0.15s ease;
    min-height: 44px; /* Accessibility - minimum touch target */
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.patient-dropdown .patient-item:hover {
    background-color: #f8f9fa !important;
}

.patient-dropdown .patient-item.selected-patient {
    background-color: #e3f2fd !important;
    box-shadow: inset 3px 0 0 #1976d2;
}

.patient-dropdown .patient-item:last-child {
    border-bottom: none;
}

.patient-dropdown .patient-name {
    font-weight: 500;
    color: #212529;
    margin-bottom: 2px;
}

.patient-dropdown .patient-dfn {
    font-size: 12px;
    color: #6c757d;
    font-family: 'Consolas', 'Monaco', monospace;
}

.patient-dropdown .patient-clinic {
    font-size: 11px;
    color: #8ca0b3;
    margin-top: 1px;
    font-style: italic;
}

.patient-dropdown mark {
    background-color: #fff3cd;
    color: #856404;
    padding: 1px 2px;
    border-radius: 2px;
    font-weight: 600;
}

.patient-dropdown .loading-state {
    padding: 16px 12px;
    text-align: center;
    color: #6c757d;
    font-style: italic;
}

.patient-dropdown .error-state {
    padding: 12px;
    background-color: #f8d7da;
    color: #721c24;
    border-radius: 4px;
    margin: 4px;
    font-size: 13px;
}

.patient-dropdown .empty-state {
    padding: 16px 12px;
    text-align: center;
    color: #6c757d;
    font-style: italic;
    font-size: 13px;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
    .patient-dropdown {
        max-height: 250px !important;
        font-size: 16px; /* Prevent zoom on iOS */
    }
    
    .patient-dropdown .patient-item {
        min-height: 48px; /* Larger touch targets on mobile */
    }
}

.citation-link {
  color: #1976d2;
  text-decoration: underline;
  cursor: pointer;
  font-size: inherit;   /* match surrounding text */
  vertical-align: baseline;
  padding: 0 2px;
}
.citation-link:hover {
  background: #ffe066;
  color: #333;
}

/* New: consistent style for excerpt citations used in notes QA */
.excerpt-citation {
  color: #1976d2;
  text-decoration: underline;
  cursor: pointer;
  font-size: inherit;   /* override global a { font-size: 2em } */
  vertical-align: baseline;
  padding: 0 2px;
}
.excerpt-citation:hover { background: #ffe066; color: #333; }

/* Override oversized anchors within content boxes */
.markdown-box a,
#notesAnswerBox a,
#notesSearchResults a,
#chartDisplay a,
#chartModalContent a {
  font-size: inherit; /* keep normal size inside prose */
}

#chartDisplay {
  font-family: "Segoe UI", Arial, sans-serif;
  line-height: 1.5;
  background: #fafbfc;
  font-size: 1.08em;
  padding: 14px;
  border-radius: 6px;
  word-break: break-word;
}
#chartDisplay h1, #chartDisplay h2, #chartDisplay h3 {
  margin-top: 1em;
  margin-bottom: 0.5em;
}
#chartDisplay ul, #chartDisplay ol {
  margin-left: 1.5em;
}
#chartDisplay mark.chart-match {
  background: #ffe066;
  padding: 0 2px;
  border-radius: 2px;
}

/* New: document viewer keyword highlight */
.doc-keyword-highlight {
  background: #ffe066;
  padding: 0 2px;
  border-radius: 2px;
}

/* --- Modal-specific overrides --- */
#chartModal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(30,30,30,0.85);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}
#chartModalInner {
  background: #fff;
  width: 50vw;           /* 50% of viewport width */
  min-width: 320px;      /* Optional: minimum width for usability */
  max-width: 700px;      /* Optional: cap max width */
  height: 95vh;          /* Nearly full viewport height */
  max-height: 99vh;
  display: flex;
  flex-direction: column;
  border-radius: 10px;
  box-shadow: 0 0 24px #2228;
  padding: 0;            /* Remove extra padding for edge-to-edge look */
  overflow: hidden;
  margin: 0 auto;        /* Center horizontally if needed */
}

#chartModalContent {
  font-size: 1.08em;
  line-height: 1.7;
  color: #222;
  background: #fafbfc;
  padding: 32px 36px;
  overflow-y: auto;
}

#chartModalContent h1, #chartModalContent h2, #chartModalContent h3 {
  color: #333;
  font-weight: 600;
  margin-top: 1.5em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

#chartModalContent p {
  margin: 0.7em 0;
}

#chartModalContent hr {
  border: none;
  border-top: 1.5px solid #e0e0e0;
  margin: 2em 0;
}

#chartModalContent ul, #chartModalContent ol {
  margin-left: 2em;
}

#chartModalContent strong, #chartModalContent b {
  color: #222;
}

/* Modal header/footer controls (optional, for navigation/search) */
#chartModalInner > .modal-controls,
#chartModalInner > .modal-header,
#chartModalInner > .modal-footer {
  padding: 18px 36px 0 36px;
  background: #fff;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border: none;
}

/* New styles for chart modal pagination */
#chartModalPageScroller {
  display: flex;
  overflow-x: auto;
  padding: 8px 16px;
  background: #f3f3f3;
  border-top: 1px solid #eee;
  border-bottom: 1px solid #eee;
  gap: 6px;
}

.page-scroll-btn {
  min-width: 32px;
  padding: 4px 10px;
  border: 1px solid #bbb;
  background: #fff;
  border-radius: 4px;
  cursor: pointer;
  font-weight: bold;
  transition: background 0.2s, border 0.2s;
}
.page-scroll-btn.active, .page-scroll-btn:hover {
  background: #ffe066;
  border: 1.5px solid #e0b800;
}

#chartModalFooter {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 14px 24px 18px 24px;
  background: #fff;
  border-top: 1px solid #eee;
}
#modalKeywordInput {
  flex: 1 1 auto;
  padding: 6px 10px;
  font-size: 1em;
  border-radius: 4px;
  border: 1px solid #bbb;
}
#modalMatchLabel {
  min-width: 120px;
  text-align: center;
  font-size: 0.98em;
  color: #444;
}

/* Archive Page Styles */
.archive-container {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.07);
    padding: 2rem 2.5rem;
    margin: 2rem auto;
    max-width: 600px;
}

.archive-controls {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

#archive-list {
    margin-top: 1rem;
}

.transcript-block {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.75rem 0;
    border-bottom: 1px solid #eee;
}

.transcript-block:last-child {
    border-bottom: none;
}

.restore-btn {
    background: #1976d2;
    color: #fff;
    border: none;
    border-radius: 4px;
    padding: 0.4em 1em;
    cursor: pointer;
    margin-right: 0.5em;
    transition: background 0.2s;
}
.restore-btn:hover {
    background: #125ea2;
}

.archive-filename {
    font-weight: 500;
    font-size: 1.08em;
    margin-left: 0.5em;
}

.global-center > button {
    margin-right: 16px;
}

.global-center > button:last-child {
    margin-right: 0;
    margin-left: 8px; /* Optional: a little space on the left of End Session */
}

a {
  text-decoration: none;
  color: var(--color-link);
  font-size: 2em;
}

a:hover {
    text-decoration: underline;
}

button {
  padding: 10px 16px;
  font-size: 1em;
  border: 2px solid var(--color-primary);
  border-radius: 8px;
  cursor: pointer;
  margin-top: 0px;
  background-color: var(--color-primary);
  color: var(--color-primary-contrast);
  font-weight: 600;
  transition: background-color 0.2s, color 0.2s, border-color 0.2s;
  white-space: normal; /* allow multi-line labels */
  max-width: 100%;
}

button:hover,
button:focus {
  background-color: var(--color-primary-dark);
  border-color: var(--color-primary-dark);
  color: var(--color-primary-contrast);
}

button:active {
  background-color: var(--color-primary-dark);
  border-color: var(--color-primary-dark);
}

button:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}

button.loading {
    position: relative;
    padding-right: 35px;
}

button.loading::after {
    content: "";
    position: absolute;
    right: 10px;
    top: 50%;
    width: 12px;
    height: 12px;
    border: 2px solid #2ecc71;
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    transform: translateY(-50%);
}

.danger-button,
.global-top-bar .danger-button {
    border: 2px solid #e74c3c;
    color: #e74c3c;
}

.danger-button:hover,
.global-top-bar .danger-button:hover,
.global-top-bar .danger-button:focus {
    background-color: #e74c3c;
    color: white;
}

.danger-button:active,
.global-top-bar .danger-button:active {
    background-color: #c0392b;
    border-color: #c0392b;
}

.start-button {
    border: 2px solid #2ecc71;
    background-color: #2ecc71;
    color: white;
    margin-right: 12px;
}

.start-button:hover {
    background-color: #27ae60;
}

.stop-button {
    border: 2px solid #e74c3c;
    background-color: #e74c3c;
    color: white;
    margin-right: 12px;
}

.stop-button:hover {
    background-color: #c0392b;
}

.top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 30px 0 0;
}

/* === Run button styles for explore page === */
.run-panel-btn {
  font-size: 0.65em;
  padding: 2px 8px;
  margin-left: 8px;
  border: 2px solid #2ecc71;
  border-radius: 4px;
  background: #f3f3f3;
  color: #2ecc71;
  cursor: pointer;
  transition: background 0.2s, border 0.2s;
}

.run-panel-btn:hover {
  background: #2ecc71;
  border-color: #27ae60;
  color: white;
}

#runAllPanelsBtn {
    font-size: 1em;
    padding: 2px 8px;
}

/* Loading states */
.loading-spinner {
    text-align: center;
    padding: 20px;
    color: #666;
}

.spinner {
    width: 24px;
    height: 24px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #3498db;
    border-radius: 50%;
    margin: 0 auto 10px;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.error-message {
    color: #e74c3c;
    padding: 10px;
    border: 1px solid #e74c3c;
    border-radius: 4px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.left-controls {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-right: auto; /* Pushes everything else to the right */
}

.right-controls {
    display: flex;
    align-items: center;
    gap: 12px; /* Reduced from 18px to prevent overflow */
}

.global-top-bar .header-title {
    color: white !important;
    font-size: 2.2em;
    font-style: italic;
    font-weight: 600;
    text-decoration: none;
}

.global-top-bar a {
    color: white;
    text-decoration: none;
    font-size: 1.8em;
}

.global-top-bar a:hover {
    text-decoration: none;
    opacity: 0.9;
}

/* Add or update these styles */
#patientInstructionsBox {
    min-height: 180px;
    width: 100%;
    margin-bottom: 10px;
    resize: vertical;
}

#patientInstructionsPreview {
    display: block; /* Ensure visible by default (was none) */
    margin-top: 0;
    margin-bottom: 10px;
}

/* Add or update these styles */
.button-group {
    display: flex;
    gap: 8px;
}

#chunkStatus {
    margin: 10px 0;
    font-style: italic;
    color: gray;
}

#exploreSearchBox {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-bottom: 16px;
}

#exploreSearchBox:focus {
    outline: none;
    border-color: #3498db;
    box-shadow: 0 0 0 2px rgba(52,152,219,0.2);
}

#exploreGptAnswer {
    margin-top: 16px;
    min-height: 120px;
}

.drop-zone {
    position: relative;
    width: 100%;
}

.drop-zone textarea {
    width: 100%;
    min-height: 200px;
    margin-bottom: 8px;
    resize: vertical;
}

.drop-overlay {
    display: none;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(52, 152, 219, 0.9);
    border: 3px dashed white;
    border-radius: 4px;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 1.5em;
    font-weight: bold;
}

.drop-zone.dragging .drop-overlay {
    display: flex;
}

/* Documents panel: three responsive compartments */
.documents-grid {
    display: grid;
    grid-template-columns: 1fr; /* single column so the table uses full middle container width */
    grid-template-areas:
        "list"; /* only one area in use */
    gap: 12px;
}
#docsListCompartment { grid-area: list; }
#docsResultsCompartment { grid-area: left; }
#docViewerCompartment { grid-area: right; }
/* Keep single-column layout on wider screens too so table spans the middle container */
@media (min-width: 900px) {
    .documents-grid { grid-template-columns: 1fr !important; grid-template-areas: "list"; }
}

/* Ensure the documents table wrappers fill their compartment (let Tabulator size itself) */
#documentsTableWrap, .doc-table-wrap { width: 100% !important; }

/* Controls vs Answers side-by-side under the table/viewer */
.docs-results-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
    align-items: start;
}
@media (min-width: 900px) {
    .docs-results-grid { grid-template-columns: 1fr 1fr; }
}
.docs-controls {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
    grid-column: 1 / -1; /* Make the Ask controls row span full width */
}
.docs-answers { min-width: 0; }
.docs-answers #notesAnswerBox,
.docs-answers #notesSearchResults {
    max-height: clamp(180px, 38vh, 480px);
    overflow: auto;
}

/* Documents table container participates in flex layout; allow shrink and avoid clipping */
.documents-module .documents-table-container {
  min-width: 0;
  display: block;
}

/* Notes Ask inline controls and answer styling */
.notes-ask-inline {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  flex-wrap: nowrap;
  max-width: 100%;
}
.notes-ask-inline input#notesAskInput {
  flex: 1 1 520px;
  min-width: 260px;
  max-width: 100%;
}
.notes-ask-inline .btn-mic {
  padding: 0;               /* tighter around the icon */
  border-radius: 6px;
  border: none;             /* remove border around Hey OMAR icon */
  background: transparent;  /* no background */
}
.notes-ask-inline .btn-mic:hover { background: transparent; }
#notesAskVoiceStatus { color: #555; font-style: italic; }

/* Mobile: wrap controls and shrink sizes to avoid horizontal overflow */
@media (max-width: 600px) {
  .notes-ask-inline { flex-wrap: wrap; }
  .notes-ask-inline input#notesAskInput { flex: 1 1 100%; min-width: 0; width: 100%; }
  .notes-ask-inline .btn-mic .hey-omar-img { height: 32px; }
  .docs-controls #notesAskBtn,
  .docs-controls #notesSummaryBtn {
    padding: 6px 10px;
    font-size: 0.92em;
  }
  /* Ensure status wraps beneath when needed */
  #notesAskVoiceStatus { flex: 1 1 100%; }
}

/* Notes QA answer box: tan background, wider, sans-serif */
#notesAnswerBox {
  background: var(--paper-panel-opaque) !important; /* match container tan */
  border: 1px solid var(--paper-border) !important;
  border-radius: 8px;
  padding: 12px 14px;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  line-height: 1.5;
  color: var(--paper-contrast);
  width: 100%;
  max-width: none;
}

/* Notes list table */
.doc-table {
    /* Give Tabulator a CSS height; JS will read computed height */
    height: 100%;
    border: none; /* removed to let .tabulator show its own border */
    border-radius: 8px;
    background: transparent; /* removed background to match new theme */
    overflow: hidden !important;   /* let Tabulator border and scrollbar render fully */
}

/* Workspace-only: keep Tabulator root non-scrolling so header/body alignment stays correct */
.tab-content .documents-module .doc-table {
  /* Keep root non-scrolling; inner .tabulator-tableholder scrolls. */
  overflow: hidden !important;
}

/* === Universal Tabulator Table Theme (applies site-wide) === */
/* Base container */
.tabulator {
  border: 1px solid #cfe3ff;
  border-radius: 8px;
  font-size: 16px;
  background: transparent; /* let parent/panel control background */
  box-sizing: border-box;  /* include border in width to avoid right-edge clipping */
}
/* Header bar and cells */
.tabulator .tabulator-header {
  background: var(--brand-blue) !important;
  border-bottom: 1px solid var(--brand-blue-dark);
}
.tabulator .tabulator-header,
.tabulator .tabulator-header .tabulator-headers,
.tabulator .tabulator-header .tabulator-col,
.tabulator .tabulator-header .tabulator-col-group,
.tabulator .tabulator-header .tabulator-col .tabulator-col-content,
.tabulator .tabulator-header .tabulator-col-row {
  background: var(--brand-blue) !important;
  background-image: none !important; /* override Tabulator gradient */
}
.tabulator .tabulator-col,
.tabulator .tabulator-col .tabulator-col-title {
  color: #fff;
  font-weight: 600;
}
/* Sorter arrows visible on blue */
.tabulator .tabulator-col .tabulator-col-sorter {
  filter: invert(1) brightness(1.4);
}
/* Header filter inputs */
.tabulator .tabulator-col .tabulator-header-filter input,
.tabulator .tabulator-col .tabulator-header-filter select {
  background: var(--paper-panel-opaque);
  color: var(--paper-contrast);
  border: 1px solid var(--paper-border);
}
.tabulator .tabulator-col .tabulator-header-filter input::placeholder { color: #6b5d54; }

/* Body/tableholder */
.tabulator .tabulator-tableholder {
  background: #fbfdff;
  /* Ensure the inner scrolling area manages scrollbars without being clipped */
  overflow-y: auto !important;
  overflow-x: auto;
}

/* Rows */
.tabulator .tabulator-row { border-bottom: 1px solid #eef5ff; }
.tabulator .tabulator-row:nth-child(even) {
  /* Fallback */
  background: rgba(52, 152, 219, 0.15);
  /* If supported, derive from brand blue */
  background: color-mix(in srgb, var(--brand-blue) 15%, white);
}
.tabulator .tabulator-row:hover { background: #e9f3ff; }
.tabulator .tabulator-row.tabulator-selected { background: #d6e9ff !important; }
/* Slightly tighter cells */
.tabulator .tabulator-row .tabulator-cell { padding: 6px 8px; }

/* Remove special highlight on Title field across all tables */
.tabulator .tabulator-cell[tabulator-field="title"] { background: transparent !important; }
.tabulator .tabulator-row:hover .tabulator-cell[tabulator-field="title"],
.tabulator .tabulator-row.tabulator-selected .tabulator-cell[tabulator-field="title"] {
  background: inherit !important;
}
/* Tidy header cell borders */
.tabulator .tabulator-header .tabulator-col,
.tabulator .tabulator-header .tabulator-col-group {
  border-right: 1px solid var(--brand-blue-dark) !important;
  box-shadow: none !important;
}

/* === Sepia / Paper Theme: Global Tabulator Overrides === */
/* Apply paper backgrounds to all Tabulator tables (panels still control container bg) */
.tabulator .tabulator-tableholder { background: var(--paper-panel) !important; }
.tabulator .tabulator-row { background: var(--paper-panel) !important; }
/* Keep alternating rows light blue universally (override warm zebra) */
.tabulator .tabulator-row:nth-child(even) {
  background: rgba(52, 152, 219, 0.15) !important;
  background: color-mix(in srgb, var(--brand-blue) 15%, white) !important;
}
/* Paper-toned header filter inputs globally */
.tabulator .tabulator-col .tabulator-header-filter input,
.tabulator .tabulator-col .tabulator-header-filter select {
  background: var(--paper-panel-opaque) !important;
  color: var(--paper-contrast) !important;
  border: 1px solid var(--paper-border) !important;
}
.tabulator .tabulator-col .tabulator-header-filter input::placeholder { color: #6b5d54 !important; }

/* === End Universal Tabulator Table Theme === */

/* === Universal Standard HTML Table Theme (non-Tabulator tables) === */
/* Base table container */
.table,
.module-table,
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
  border: 1px solid #cfe3ff;
  border-radius: 8px;
  overflow: hidden; /* clip rounded corners */
  background: transparent;
}
/* Header */
.table thead th,
.module-table thead th,
table thead th {
  background: var(--brand-blue);
  color: #fff;
  font-weight: 600;
  padding: 8px;
  border-right: 1px solid var(--brand-blue-dark);
  text-align: left;
}
.table thead th:last-child,
.module-table thead th:last-child,
table thead th:last-child { border-right: none; }
/* Body cells */
.table tbody td,
.module-table tbody td,
table tbody td {
  padding: 6px 8px;
  border-bottom: 1px solid #eef5ff;
}
/* Zebra and hover */
.table tbody tr:nth-child(even),
.module-table tbody tr:nth-child(even),
table tbody tr:nth-child(even) {
  /* Fallback */
  background: rgba(52, 152, 219, 0.15);
  /* If supported */
  background: color-mix(in srgb, var(--brand-blue) 15%, white);
}
.table tbody tr:hover,
.module-table tbody tr:hover,
table tbody tr:hover { background: #e9f3ff; }

/* Sepia / Paper overrides for plain tables */
.table tbody tr,
.module-table tbody tr,
table tbody tr { background: var(--paper-panel) !important; }
.table tbody tr:nth-child(even),
.module-table tbody tr:nth-child(even),
table tbody tr:nth-child(even) {
  background: rgba(52, 152, 219, 0.15) !important;
  background: color-mix(in srgb, var(--brand-blue) 15%, white) !important;
}

/* === End Universal Standard HTML Table Theme === */

/* Document viewer */
.doc-viewer-wrap { position: relative; flex: 1 1 auto; min-height: 0; }
.doc-viewer {
    margin: 0;
    padding: 10px;
    border: 1px solid #e6e6e6;
    border-radius: 8px;
    background: #fbfbfb;
    white-space: pre-wrap;
    word-wrap: break-word;
    /* Fill remaining height under tabs */
    height: 100%;
    max-height: none;
    min-height: 0;
    overflow: auto;
    /* Seamless join with tabs */
    margin-top: 0;
    border-top: none;
    border-top-left-radius: 0;
    border-top-right-radius: 0;
  font-size: 0.95em; /* moved from inline */
}
.doc-viewer-copy {
    position: absolute;
    right: 8px;
    bottom: 8px;
    padding: 6px 10px;
    font-size: 0.9em;
    border-radius: 6px;
    border: 1px solid var(--paper-border);
    background: #fff;
    color: #2ecc71;
}
.doc-viewer-copy:hover { background: #f2fff5; }

/* Documents table wrapper positions the overlayed viewer */
.doc-table-wrap {
  position: relative;
  /* Allow child outlines/edges to render fully */
  overflow: visible;
}
/* Make the documents area resizable and synced */
#documentsTableWrap {
  height: clamp(300px, 40vh, 70vh);
  resize: vertical;
  /* Do not clip child outlines; Tabulator scrolls internally */
  overflow: visible;
  position: relative; /* ensure overlay positions within this wrapper */
  /* Minimal right gutter to avoid visual edge clipping */
  padding-right: 8px;
  box-sizing: border-box;
}

/* Allow flex children to actually shrink within the panel to avoid right-edge clipping */
.documents-module .documents-table-container,
.documents-module #documentsTableWrap,
.documents-module .doc-table {
  min-width: 0;
}
/* Overlayed note viewer sits under the table header and over rows */
.doc-viewer-overlay {
  position: absolute;
  left: 0; right: 0;
  top: 0; /* will be updated in JS to header height */
  bottom: 0; /* fill to bottom of wrapper */
  z-index: 5;
  background: #fff;
  /* No extra border on overlay; the tabs/viewer carry borders */
  box-shadow: 0 2px 10px rgba(0,0,0,0.06);
  display: flex;
  flex-direction: column;
}
/* Tabs connect to the viewer (folder-tab look) */
.doc-tabs { margin-bottom: 0; display:flex; align-items:stretch; gap:0; border-bottom: none; }
.doc-tabs .doc-tab.current {
  border-bottom: none;
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
  position: relative;
  z-index: 2;
}
/* De-emphasize prev/next labels */
#docTabPrev .tab-label, #docTabNext .tab-label {
  color: rgba(59,47,42,0.7);
  font-style: italic;
  font-weight: 500;
}

/* === Note Viewer Tabs === */
.doc-tabs {
  display: flex;
  align-items: stretch;
  gap: 6px;
  padding: 4px 6px;
  background: var(--paper-panel);
  border: 1px solid var(--paper-border);
  padding-right: 6px;            /* tiny guard so right edge never appears cut */
  border-bottom: none; /* remove bottom border to connect with viewer */
  border-radius: 8px 8px 0 0; /* top rounded only */
  margin-bottom: 0;
}
.doc-tabs .doc-tab {
  display: flex;
  align-items: center;
  gap: 6px;
  min-width: 0; /* allow ellipsis */
  flex: 1 1 0;
  background: var(--paper-panel);
  border: 1px solid var(--paper-border);
  border-bottom: none; /* connect with viewer */
  border-radius: 8px 8px 0 0; /* top rounded only */
  padding: 2px 6px;
}
.doc-tabs .doc-tab.current {
  border-color: var(--brand-blue-dark);
  box-shadow: inset 0 0 0 1px var(--brand-blue-dark), 0 1px 2px rgba(0,0,0,0.06);
  border-bottom: none;
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
  position: relative;
  z-index: 2;
}
.doc-tabs .tab-chev {
  border: 1px solid var(--paper-border);
  background: #fff;
  color: #333;
  border-radius: 999px;
  padding: 2px 6px;
  line-height: 1;
  cursor: pointer;
  font-size: 12px;
}
.doc-tabs .tab-chev:hover { background: #f2fff5; border-color: #cfe3ff; }
.doc-tabs .tab-chev:disabled { opacity: 0.5; cursor: not-allowed; }
.doc-tabs .tab-label {
  border: none;
  background: transparent;
  color: var(--paper-contrast);
  font-weight: 600;
  min-width: 0;
  flex: 1 1 auto;
  text-align: left;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding: 2px 4px;
  cursor: pointer;
}
.doc-tabs .doc-tab[data-state="disabled"] .tab-label { opacity: 0.7; cursor: default; }
.doc-tabs .doc-tab[data-state="disabled"] .tab-chev { opacity: 0.3; cursor: not-allowed; }
.doc-tabs .doc-tab-close {
  margin-left: auto;
  border: 1px solid var(--paper-border);
  background: #fff;
  color: #333;
  border-radius: 6px;
  padding: 2px 8px;
  cursor: pointer;
}
.doc-tabs .doc-tab-close:hover { background: #ffe6e6; border-color: #e8b3b3; }
/* De-emphasize prev/next labels */
#docTabPrev .tab-label, #docTabNext .tab-label {
  color: rgba(59,47,42,0.7);
  font-style: italic;
  font-weight: 500;
}
/* === End Note Viewer Tabs === */

/* --- Light blue (table row) background utility --- */
.bg-row-blue {
  /* Fallback */
  background: rgba(52, 152, 219, 0.15) !important;
  /* Preferred (derived from brand blue) */
  background: color-mix(in srgb, var(--brand-blue) 15%, white) !important;
}

/* Apply light blue to note viewer and its tabbed headers */
.doc-viewer,
.doc-viewer-overlay,
.doc-tabs,
.doc-tabs .doc-tab {
  /* Fallback */
  background: rgba(52, 152, 219, 0.04) !important;
  /* Preferred */
  background: color-mix(in srgb, var(--brand-blue) 4%, white) !important;
}

/* Search inputs: docs keyword, notes search/ask, explore search, patient search, modal keyword */
#docsKeywordInput,
#notesSearchInput,
#notesAskInput,
#exploreSearchBox,
#patientSearchInput,
#modalKeywordInput {
  /* Fallback */
  background-color: rgba(52, 152, 219, 0.04) !important;
  /* Preferred */
  background-color: color-mix(in srgb, var(--brand-blue) 4%, white) !important;
  border-color: #cfe3ff !important;
  color: #222;
}
#docsKeywordInput::placeholder,
#notesSearchInput::placeholder,
#notesAskInput::placeholder,
#exploreSearchBox::placeholder,
#patientSearchInput::placeholder,
#modalKeywordInput::placeholder { color: #3b4a5a; }

/* Result boxes (notes answer/search) and keep visibility by overriding inline styles */
#notesAnswerBox,
#notesSearchResults {
  /* Fallback */
  background: rgba(52, 152, 219, 0.04) !important;
  /* Preferred */
  background: color-mix(in srgb, var(--brand-blue) 4%, white) !important;
  border-color: #cfe3ff !important;
}

/* === Sepia / Paper Theme Overrides === */
:root {
  /* Warm paper palette */
  --paper-bg: #f3ead7;            /* page background */
  --paper-panel: #fbf4e4;         /* cards/panels */
  --paper-panel-opaque: #fbf4e4ee;/* translucent card */
  --paper-contrast: #3b2f2a;      /* text color */
  --paper-border: #d8c7a8;        /* warm border */
  --paper-modal: #f7efe0;         /* modal content */
}

/* Page background and base text */
body {
  background-color: var(--paper-bg) !important;
  color: var(--paper-contrast);
}

/* Main containers/cards */
.container {
  background: var(--paper-panel-opaque) !important;
  border: 1px solid var(--paper-border);
  box-shadow: 0 8px 20px rgba(94, 73, 55, 0.12);
}

.panel,
.archive-container,
.markdown-box,
.doc-viewer,
#chartDisplay,
#chartModalContent,
#chartModalInner,
.mobile-menu,
.doc-table .tabulator-tableholder {
  background: var(--paper-panel) !important;
  color: var(--paper-contrast);
}

/* Modal sections (header/footer) */
#chartModalInner > .modal-controls,
#chartModalInner > .modal-header,
#chartModalInner > .modal-footer {
  background: var(--paper-panel) !important;
}

/* Borders for paper components */
.panel,
.archive-container,
.markdown-box,
.doc-viewer {
  border-color: var(--paper-border) !important;
}

/* Inputs/selects match paper tone */
textarea,
input[type="text"],
select {
  background-color: var(--paper-panel) !important;
  border-color: var(--paper-border) !important;
  color: var(--paper-contrast);
}

/* Modal content a touch lighter */
#chartModalContent { background: var(--paper-modal) !important; }

/* Keep highlight and brand accents unchanged; blue top bar and table header remain as-is */

/* === Sepia tweaks for Documents Table === */
:root {
  --paper-alt-row: #efe5cf;     /* slightly darker paper for zebra rows */
  --paper-hover: #efe2c7;       /* hover tone */
  --paper-selected: #e7d8b7;    /* selected tone */
}

/* Base table body background to paper */
.doc-table .tabulator-tableholder { background: var(--paper-panel) !important; }
.doc-table .tabulator-row { background: var(--paper-panel) !important; }

/* Documents-only: render an inner border so edges never appear clipped */
.documents-module .doc-table .tabulator {
  border: none !important;                   /* remove outer border that can be clipped */
  box-shadow: inset 0 0 0 1px var(--paper-border) !important; /* draw border inside */
}
/* Reserve right-side space for scrollbar only within documents table to prevent clipping */
.documents-module .doc-table .tabulator-tableholder {
  /* Prefer reserving only the right gutter; browsers may treat 'stable' as right only */
  scrollbar-gutter: stable;
  box-sizing: border-box;
}

/* Zebra, hover, and selection with warm tones */
.doc-table .tabulator-row:nth-child(even) { background: var(--paper-alt-row) !important; }
.doc-table .tabulator-row:hover { background: var(--paper-hover) !important; }
.doc-table .tabulator-row.tabulator-selected { background: var(--paper-selected) !important; }

/* === Requested adjustments: blue zebra rows, paper filter inputs, paper-border scrollbar === */
/* Keep alternating rows light blue as prior */
.doc-table .tabulator-row:nth-child(even) {
  /* Fallback */
  background: rgba(52, 152, 219, 0.15) !important;
  /* If supported, derive from brand blue */
  background: color-mix(in srgb, var(--brand-blue) 15%, white) !important;
}

/* Paper-toned header filter inputs/selects (search bars) */
.doc-table .tabulator-col .tabulator-header-filter input,
.doc-table .tabulator-col .tabulator-header-filter select {
  background: var(--paper-panel-opaque) !important;
  color: var(--paper-contrast) !important;
  border: 1px solid var(--paper-border) !important;
}
.doc-table .tabulator-col .tabulator-header-filter input::placeholder {
  color: #6b5d54;
}

/* Paper-border scrollbar across the app */
/* Firefox */
* { scrollbar-color: var(--paper-panel) var(--paper-border); scrollbar-width: thin; }
/* WebKit */
*::-webkit-scrollbar { width: 12px; height: 12px; }
*::-webkit-scrollbar-track { background: var(--paper-border); }
*::-webkit-scrollbar-thumb {
  background-color: var(--paper-panel);
  border-radius: 8px;
  border: 2px solid var(--paper-border);
}
/* === End adjustments === */

/* === End Sepia / Paper Theme Overrides === */

/* ========================= VADesign Theme (opt-in) ========================= */
/* Apply by setting: document.documentElement.dataset.theme = 'va' */
:root[data-theme="va"] {
  /* VA-inspired subdued palette */
  --va-primary: #3a6685;
  --va-primary-dark: #2f526b;
  --va-primary-contrast: #ffffff;
  --va-link: #1a4480;           /* USWDS-like link */
  --va-link-hover: #14345f;
  --va-accent: #c9a85b;         /* muted sand/gold */
  --va-accent-contrast: #2b2417;
  --va-success: #2e7d32;        /* subdued green */
  --va-danger: #b71c1c;         /* strong error */
  --va-gray-100: #f5f6f7;
  --va-gray-200: #e3e7ea;
  --va-gray-300: #cdd5db;
  --va-gray-700: #4a5561;
  /* Buttons-only brighter blue (vivid VA/USWDS) */
  --va-button: #3BA3E3;           /* Softer sky blue */
  --va-button-hover: #2C89C6;     /* Hover */
  --va-button-active: #1F6FA8;    /* Active/Pressed */
  --va-button-contrast: #ffffff;  /* Text */

  /* Map semantic tokens to VA palette */
  --color-primary: var(--va-primary);
  --color-primary-dark: var(--va-primary-dark);
  --color-primary-contrast: var(--va-primary-contrast);
  --color-link: var(--va-link);
  --color-link-hover: var(--va-link-hover);
  --color-success: var(--va-success);
  --color-danger: var(--va-danger);
  --color-muted: var(--va-gray-700);
  --color-strong: #182029;
  --color-border: var(--va-gray-300);

  /* Keep warm paper, slightly lighter/less saturated for a calmer feel */
  --paper-bg: #f4ecde;
  --paper-panel: #fbf6eb;
  --paper-panel-opaque: #fbf6ebee;
  --paper-border: #e0d3bb;
  --paper-modal: #f9f2e4;
}

/* VA buttons: solid fill with contrast text and wrapping */
[data-theme="va"] button,
[data-theme="va"] .start-button,
[data-theme="va"] .stop-button,
[data-theme="va"] .danger-button {
  /* Use brighter button palette without changing global header/table backgrounds */
  border: 2px solid var(--va-button);
  background: var(--va-button);
  color: var(--va-button-contrast);
  padding: 10px 16px;
  height: auto;
  font-size: 1em;
  white-space: normal;
  transition: background-color 0.18s ease, color 0.18s ease, border-color 0.18s ease, box-shadow 0.18s ease;
}
[data-theme="va"] button:hover,
[data-theme="va"] .start-button:hover,
[data-theme="va"] .stop-button:hover,
[data-theme="va"] .danger-button:hover,
[data-theme="va"] button:focus {
  background: var(--va-button-hover);
  color: var(--va-button-contrast);
  border-color: var(--va-button-hover);
}
[data-theme="va"] .start-button {
  background: var(--va-success);
  border-color: var(--va-success);
}
[data-theme="va"] .start-button:hover { background: color-mix(in srgb, var(--va-success) 85%, black); border-color: color-mix(in srgb, var(--va-success) 85%, black); }
[data-theme="va"] .stop-button,
[data-theme="va"] .danger-button {
  background: var(--va-danger);
  border-color: var(--va-danger);
}
[data-theme="va"] .stop-button:hover,
[data-theme="va"] .danger-button:hover { background: color-mix(in srgb, var(--va-danger) 85%, black); border-color: color-mix(in srgb, var(--va-danger) 85%, black); }
[data-theme="va"] button:focus-visible {
  outline: 2px solid color-mix(in srgb, var(--va-button) 45%, white);
  outline-offset: 2px;
}
[data-theme="va"] button:active { background: var(--va-button-active); border-color: var(--va-button-active); }
[data-theme="va"] button:disabled {
  opacity: 0.6;
}

/* VA links */
[data-theme="va"] a { color: var(--color-link); }
[data-theme="va"] a:hover { color: var(--color-link-hover); text-decoration: underline; }

/* VA top bar and table headers (optional; can be toggled later) */
[data-theme="va"] .global-top-bar { background: var(--color-primary) !important; }
[data-theme="va"] .tabulator .tabulator-header,
[data-theme="va"] .tabulator .tabulator-header .tabulator-headers,
[data-theme="va"] .tabulator .tabulator-header .tabulator-col,
[data-theme="va"] .tabulator .tabulator-header .tabulator-col-group,
[data-theme="va"] .tabulator .tabulator-header .tabulator-col .tabulator-col-content,
[data-theme="va"] .tabulator .tabulator-header .tabulator-col-row {
  background: var(--color-primary) !important;
}
[data-theme="va"] .tabulator .tabulator-col,
[data-theme="va"] .tabulator .tabulator-col .tabulator-col-title { color: var(--color-primary-contrast); }
[data-theme="va"] .tabulator .tabulator-header .tabulator-col,
[data-theme="va"] .tabulator .tabulator-header .tabulator-col-group {
  border-right: 1px solid var(--color-primary-dark) !important;
}

/* VA zebra/hover: slightly cooler neutrals, still subtle */
[data-theme="va"] .tabulator .tabulator-row:nth-child(even) {
  background: color-mix(in srgb, var(--color-primary) 9%, white) !important;
}
[data-theme="va"] .tabulator .tabulator-row:hover { background: #ecf2f6 !important; }
[data-theme="va"] .tabulator .tabulator-row.tabulator-selected { background: #d9e6ef !important; }

/* VA paper adjustments */
[data-theme="va"] body { background-color: var(--paper-bg) !important; color: var(--paper-contrast); }
[data-theme="va"] .container,
[data-theme="va"] .panel,
[data-theme="va"] .archive-container,
[data-theme="va"] .markdown-box,
[data-theme="va"] .doc-viewer,
[data-theme="va"] #chartDisplay,
[data-theme="va"] #chartModalContent,
[data-theme="va"] #chartModalInner,
[data-theme="va"] .mobile-menu,
[data-theme="va"] .doc-table .tabulator-tableholder {
  background: var(--paper-panel) !important;
  border-color: var(--paper-border) !important;
}
[data-theme="va"] .doc-tabs,
[data-theme="va"] .doc-tabs .doc-tab {
  /* Keep a warm tab colored background */
  background: color-mix(in srgb, var(--va-accent) 25%, var(--paper-panel)) !important;
}
/* ========================================================================= */

/* --- Final overrides: 4% brand tint + connected tabs/viewer --- */
/* Keep the note viewer area lightly tinted at 4% regardless of sepia overrides */
.documents-grid .doc-tabs,
.documents-grid .doc-tabs .doc-tab,
.documents-grid .doc-viewer,
.documents-grid .doc-viewer-overlay {
  /* Fallback */
  background: rgba(52, 152, 219, 0.04) !important;
  /* Preferred */
  background: color-mix(in srgb, var(--brand-blue) 4%, white) !important;
}
/* Remove any seam between the tab strip and the note body */
.documents-grid .doc-tabs { border-bottom: none !important; margin-bottom: 0 !important; }

/* Diagnostics removed */
.documents-grid .doc-viewer { border-top: none !important; border-top-left-radius: 0 !important; border-top-right-radius: 0 !important; }

/* --- Note viewer tabs: show line under prev/next, none under current --- */
/* Ensure non-current tabs have a bottom border (line) */
.documents-grid .doc-tabs .doc-tab { border-bottom: 1px solid var(--paper-border); }
/* Keep the current (middle) tab connected to the viewer with no bottom border */
.documents-grid .doc-tabs .doc-tab.current { border-bottom: none; }

/* --- Document viewer: remove inner box around the text --- */
#docViewText {
  border: none !important;
  background: transparent !important;
  box-shadow: none !important;
}

/* --- Inactive (prev/next) doc tabs: italic, not bold --- */
#docTabLeft, #docTabRight {
  font-style: italic;
  font-weight: 400;
}

/* --- Workspace tabs: connect active tab to content (no dividing line) --- */
.workspace-pane .tab-bar .tab.active {
  border-bottom: none !important;
}
.workspace-pane .tab-content.active {
  border-top: none !important;
}

/* Viewer status placement and look */
.doc-viewer-status {
  position: absolute;
  bottom: 8px;
  left: 8px;
  font-size: 0.85em;
  color: #555;
}

/* Mobile tweaks for headers inside compartments */
@media (max-width: 480px) {
    .compartment-header { font-size: 0.95em; }
}

/* Hide hamburger and mobile menu by default */
.hamburger-btn, .mobile-menu {
    display: none;
}

/* Ensure mobile menu can open on all screen sizes */
.mobile-menu {
  display: none;
  position: fixed;
  top: 56px;
  right: 0;
  width: 320px;
  max-width: 320px;
  background: #fff;
  box-shadow: -2px 0 12px rgba(0,0,0,0.15);
  z-index: 2000;
  flex-direction: column;
  padding: 1.5em 1em;
  gap: 1em;
  border-radius: 0 0 0 12px;
}
.mobile-menu.open { display: flex; }

/* Responsive styles for small screens. BUT TEMPORARILY INCREASING TO FULL SCREEN TO LOOK AT DESIGN*/
@media (max-width: 900px) {
    .global-top-bar {
        padding: 8px 8px;
    }
    .right-controls {
        gap: 0;
    }
    .header-title {
        display: none !important;
    }
    .start-button, .danger-button, .right-controls a {
        display: none !important;
    }
    .hamburger-btn {
        display: block !important;
        background: none;
        border: none;
        font-size: 2em;
        color: #fff;
        margin-left: auto;
        cursor: pointer;
    }
    /* Compact record button */
    #recordBtn {
        display: inline-flex !important;
        font-size: 1em;
        padding: 8px 18px;
        border-radius: 8px;
        min-width: 80px;
        min-height: 36px;
        justify-content: center;
        align-items: center;
        white-space: nowrap;
    }
    /* Show mobile menu when active */
    .mobile-menu {
        display: none;
        position: fixed;
        top: 56px;
        right: 0;
        width: 70vw;
        max-width: 260px;
        background: #fff;
        box-shadow: -2px 0 12px rgba(0,0,0,0.15);
        z-index: 2000;
        flex-direction: column;
        padding: 1.5em 1em;
        gap: 1em;
        border-radius: 0 0 0 12px;
    }
    .mobile-menu.open {
        display: flex;
    }
    .mobile-menu a, .mobile-menu button {
        display: block;
        width: 100%;
        margin: 0.5em 0;
        text-align: left;
        font-size: 1.1em;
    }
    .mobile-menu-separator {
        border: none;
        border-top: 1px solid #e0e0e0;
        margin: 0.5em 0 0.5em 0;
    }
    .end-session-link {
        color: #1976d2;
        font-weight: normal;
        font-size: 1em;
        margin: 0.5em 0;
        display: block;
        text-align: left;
        background: none;
        border: none;
        text-decoration: none;
        cursor: pointer;
    }
    .end-session-link:hover {
        color:#e74c3c;
        background: none;
        text-decoration: underline;
    }
    /* Mobile: make documents table + note viewer taller */
    #documentsTableWrap { height: clamp(480px, 70vh, 88vh) !important; }
}

/* === Mobile Explore: two circular buttons under top bar === */
.mobile-row-buttons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  padding: 40px 20px 0px 20px;
  align-items: center;
}
.mobile-row-buttons .circle-btn {
  background: transparent !important;
  border: none !important;
  padding: 0;
  width: 100%;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  aspect-ratio: 1 / 1; /* equal square hit areas */
  
  /* Enhanced touch responsiveness for mobile buttons */
  /* Disable text selection and highlight on touch */
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  
  /* Disable callout on iOS Safari */
  -webkit-touch-callout: none;
  
  /* Prevent iOS zoom on double-tap */
  touch-action: manipulation;
  
  /* Improve touch target size for accessibility */
  min-width: 44px;
  min-height: 44px;
  
  /* Smooth transitions for visual feedback */
  transition: transform 0.1s ease, opacity 0.1s ease;
}

/* Visual feedback for active touch state */
.mobile-row-buttons .circle-btn:active {
  transform: scale(0.95);
  opacity: 0.8;
}

/* Prevent unwanted text selection on touch */
.mobile-row-buttons .circle-btn *,
.mobile-row-buttons .circle-btn img {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
  pointer-events: none; /* Let touch events bubble to button */
}
.mobile-row-buttons .circle-btn img {
  display: block;
  width: 90%;
  height: 90%;
  object-fit: contain;
}
/* Scale Hey OMAR artwork to 80% within its square */
.mobile-row-buttons .btn-mic .hey-omar-img { width: 75% !important; height: 75% !important; }
/* Ensure the record image button has no border/background and can receive glow */
.image-record-btn { background: transparent !important; border: none !important; }
.image-record-btn:focus-visible { outline: 2px solid #aeeaff; border-radius: 999px; }

/* Overlay glow ABOVE the stop image when recording */
.mobile-row-buttons .image-record-btn { position: relative; }
.mobile-row-buttons .image-record-btn img { position: relative; z-index: 1; }
.image-record-btn::after {
  content: "";
  position: absolute;
  inset: 10%;                 /* roughly match the 90% img sizing */
  border-radius: 50%;
  pointer-events: none;
  z-index: 2;                /* above the image */
  opacity: 0;                /* enabled only while recording */
  /* Use CSS variable from JS to control intensity */
  box-shadow:
    0 0 var(--record-glow, 0px) rgba(239, 68, 68, 0.85),
    0 0 calc(var(--record-glow, 0px) * 2.4) rgba(239, 68, 68, 0.45),
    inset 0 0 calc(var(--record-glow, 0px) * 0.6) rgba(239, 68, 68, 0.35);
  transition: opacity 120ms ease;
}
.image-record-btn.recording::after { opacity: 1; }

/* On very small screens, tighten gap */
@media (max-width: 420px){ .mobile-row-buttons { gap: 8px; padding: 6px 8px; } }

@media (max-width: 800px) {

    .side-by-side {
        flex-direction: column;
    }
    .side-by-side > .panel {
        max-width: 100%;
        min-width: 0;
    }
    #chartModalInner {
        width: 95vw;
        max-width: 99vw;
        min-width: unset;
    }
}

/* New: Keep docsKeyword input + buttons together */
.docs-inline-group {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  white-space: nowrap;
  flex-wrap: nowrap;
}

/* --- Explore: three-column grid with left and right sidebars --- */
.explore-grid { display: grid; grid-template-columns: 300px 1fr 300px; gap: 18px; align-items: start; }
.left-sidebar { padding: 6px 8px 6px 6px; background: transparent; }
.main-content { min-width: 0; }
@media (max-width: 1000px){ .explore-grid { grid-template-columns: 1fr; } }

/* --- Vitals Sidebar (no box; sits on background) --- */
.vitals-sidebar { background: transparent; border: none; padding: 6px 4px; }
.vitals-sidebar .vital-item { cursor: pointer; user-select: none; margin: 8px 0 2px 0; }
.vitals-sidebar .vital-item:focus { outline: 2px solid #cfe3ff; border-radius: 4px; }
.vitals-sidebar .vital-line { color: #3498db; font-weight: 700; font-size: 1.6em; letter-spacing: 0.3px; }
.vitals-sidebar .vital-details { margin: 2px 0 10px 4px; padding-left: 6px; border-left: 3px solid #cfe3ff; }
.vitals-sidebar .vital-reads { list-style: none; margin: 6px 0 0 0; padding: 0; }
.vitals-sidebar .vital-reads li { font-size: 0.96em; color: #3b2f2a; margin: 2px 0; }

/* --- Right sidebar meds status styling --- */
.vitals-sidebar .vital-reads li.med-active { color: var(--brand-blue); }
.vitals-sidebar .vital-reads li.med-expired { color: #777; font-style: italic; }
.vitals-sidebar .vital-reads li.med-discontinued { color: #777; font-style: italic; text-decoration: line-through; }

.vital-loading, .vital-error, .vital-empty { color: #555; font-style: italic; }

/* --- Standalone Vitals Sidebar (on background) --- */
.vitals-standalone { margin: 8px 14px; }
.vitals-standalone .vitals-sidebar { background: transparent; border: none; padding: 6px 4px; }

/* Layout: 2-column grid for first two rows, third row also two cells */
.vitals-grid { display: grid; grid-template-columns: auto auto; gap: 8px 8px; align-items: end; }
.vital-cell { display: flex; align-items: flex-end; gap: 2px; justify-content: flex-end; text-align: right; }

/* Thin / tall numeric style (keep brand blue color) */
.vital-big { color: var(--brand-blue); font-weight: 300; line-height: 1.05; font-variant-numeric: tabular-nums; }
.vital-big .unit-small { color: #000; font-size: 0.55em; font-weight: 500; margin-left: 4px; }

/* Heart Rate block: big blue value, small black bpm - right aligned */
.hr-readout { display: inline-flex; align-items: baseline; gap: 6px; justify-content: flex-end; }
.hr-value { color: var(--brand-blue); font-weight: 300; font-size: 40px; line-height: 1; text-align: right; }
.hr-bpm { color: #000; font-size: 0.7em; font-weight: 600; letter-spacing: 0.3px; }

/* Blood Pressure special layout with diagonal - right aligned */
.bp-readout { position: relative; display: inline-block; padding-right: 48px; text-align: right; }
.bp-sys { font-size: 36px; }
/* Bring slash and diastolic closer to systolic to fit column better */
.bp-dia { position: absolute; left: calc(65% + 2px); top: 20px; font-size: 36px; }
.bp-slash { position: absolute; left: calc(60% + 2px); top: -2px; width: 2px; height: 56px; background: var(--brand-blue); transform: rotate(30deg); opacity: 0.9; }

/* Smaller, black labels for RR and SpO2 */
.small-black { color: #000; font-size: 0.92em; font-weight: 600; letter-spacing: 0.2px; }

/* Temperature and Weight with small unit suffixes - right aligned */
.vital-value { color: var(--brand-blue); font-weight: 300; font-size: 28px; line-height: 1; text-align: right; }
.unit-small { color: #000; font-size: 0.7em; font-weight: 600; margin-left: 4px; }

/* Units in brand blue (e.g., SpO2 percent) */
.unit-blue { color: var(--brand-blue); font-size: 0.7em; font-weight: 600; margin-left: 2px; }

/* RR / SpO2: labels small black, values big blue like HR - right aligned */
.vital-label { color: #000; font-size: 0.7em; font-weight: 600; letter-spacing: 0.3px; }
.vital-large { color: var(--brand-blue); font-weight: 300; font-size: 40px; line-height: 1; text-align: right; }

/* Delta triangles: on the left of the right-aligned values */
.delta-wrap { display: inline-flex; flex-direction: column; gap: 0; margin-left: 0; margin-right: 4px; align-self: center; order: -1; }
.delta-tri { color: #DAA520; font-size: 12px; line-height: 1; display: block; }
/* Collapse any remaining space between stacked arrows */
.delta-wrap .delta-tri + .delta-tri { margin-top: -2px; }

/* Popover for last 3 values */
.vital-popover { position: absolute; z-index: 2000; background: #fff; border: 1px solid #ddd; border-radius: 6px; box-shadow: 0 6px 18px rgba(0,0,0,0.15); padding: 8px 10px; color: var(--brand-blue); font-size: 12px; line-height: 1.3; }
.vital-popover h4 { margin: 0 0 4px 0; font-size: 12px; color: #333; font-weight: 600; }
.vital-popover .row { white-space: nowrap; }
.vital-popover .row.abnormal { color: #ef5350; }
.vital-popover .row.critical { color: #b71c1c; }

@media (max-width: 900px){
  .bp-sys { font-size: 40px; }
  .bp-readout { padding-right: 48px; }
  .bp-dia { font-size: 36px; top: 20px; left: calc(65% + 2px); }
  .bp-slash { height: 56px; left: calc(60% + 2px); top: -2px; }
  .vital-large { font-size: 32px; }
}

@media (max-width: 900px){
  .vitals-standalone { margin: 6px 8px; }
  .bp-sys { font-size: 40px; }
  .bp-dia { font-size: 36px; top: 20px; left: calc(65% + 2px); }
  .bp-slash { height: 56px; left: calc(60% + 2px); top: -2px; }
  .hr-value { font-size: 32px; }
  .vital-value { font-size: 24px; }
}

/* --- Labs fishbone under vitals --- */
.vitals-separator {
  height: 1px;
  background: var(--brand-blue);
  opacity: 0.8;
  margin: 40px 0 40px 0;
  border-radius: 1px;
}
.labs-fishbone { margin: 12px 2px 2px 2px; }
.labs-fishbone svg { display: block; max-width: 100%; height: auto; }
.labs-fishbone .lab-value { font-size: 28px; font-weight: 400; }

/* --- Labs fishbone extras (key labs list + overrides) --- */
.labs-fishbone a.labs-recent-link { font-size: 0.95em !important; }
.labs-list { margin: 6px 2px 8px 2px; display: grid; gap: 4px; }
.labs-item { display: flex; align-items: baseline; gap: 6px; }
.labs-label { color: #000; font-weight: 600; }
.labs-value { color: var(--brand-blue); font-weight: 300; }
.labs-value.abnormal { color: #ef5350 !important; }
.labs-value.critical { color: #b71c1c !important; }
.labs-date { color: #555; font-size: 0.85em; }

/* --- Labs key list unit handling and lighter abnormal color --- */
.labs-item { cursor: pointer; }
.labs-value.abnormal { color: #ef5350; }
.labs-value-wrap { display: inline-flex; align-items: baseline; gap: 4px; white-space: nowrap; }
.labs-unit { color: #000; font-size: 0.7em; font-weight: 300; margin-left: 2px; }

/* Hide mobile menu by default; keep hamburger visible on all sizes */
.mobile-menu { display: none; }
/* Hide right-side icon links on all screen sizes (use hamburger instead) */
.right-controls a { display: none !important; }
/* Ensure hamburger is visible and styled */
.hamburger-btn { display: block !important; background: none; border: none; font-size: 2em; color: #fff; margin-left: 0; cursor: pointer; }

/* === Voice Ask glow pulse === */
@keyframes askGlowPulse {
  0% { box-shadow: 0 0 0px rgba(52,152,219,0.0); }
  50% { box-shadow: 0 0 14px rgba(52,152,219,0.45); }
  100% { box-shadow: 0 0 0px rgba(52,152,219,0.0); }
}
.glow-pulse {
  animation: askGlowPulse 1.4s ease-in-out infinite;
  border-color: #3498db !important;
}

/* Small mic button next to Ask */
.btn-mic {
  border-color: #3498db;
  color: #3498db;
  padding: 8px 10px;
}
.btn-mic:hover { background: #e8f4ff; }

/* Voice Ask UI */
.btn-mic {
  margin-left: 6px;
  padding: 4px 8px;
  border: 1px solid #d0d7de;
  border-radius: 6px;
  background: #f6f8fa;
  cursor: pointer;
}
.btn-mic:hover { background: #eef2f6; }
.voice-status { margin-left: 6px; font-size: 0.9em; color: #2563eb; }

/* Pulsating blue glow on the Ask input while listening */
.glow-pulse {
  outline: none !important;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.25), 0 0 0 6px rgba(37, 99, 235, 0.12);
  animation: pulseGlow 1.4s ease-in-out infinite;
}
@keyframes pulseGlow {
  0% { box-shadow: 0 0 0 2px rgba(37,99,235,0.18), 0 0 0 4px rgba(37,99,235,0.10); }
  50%{ box-shadow: 0 0 0 4px rgba(37,99,235,0.30), 0 0 0 8px rgba(37,99,235,0.18); }
  100%{ box-shadow: 0 0 0 2px rgba(37,99,235,0.18), 0 0 0 4px rgba(37,99,235,0.10); }
}

/* --- Tabulator stability + overflow controls --- */
/* Allow horizontal scroll if sum of column mins exceeds container */
.tabulator .tabulator-tableholder { overflow-x: auto; }
/* Prevent long cell content from forcing column growth */
.tabulator .tabulator-row .tabulator-cell,
.tabulator .tabulator-header .tabulator-col .tabulator-col-title {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  min-width: 40px;
}
/* Keep links inside cells from inheriting oversized global <a> font */
.tabulator .tabulator-cell a { font-size: inherit; }
/* Ensure the Tabulator root never exceeds its parent width */
.tabulator { max-width: 100%; box-sizing: border-box; }

/* Grid children must be allowed to shrink below content width to avoid lateral growth */
.explore-grid > *,
.documents-grid > *,
#docsListCompartment,
#docsResultsCompartment,
#docViewerCompartment {
  min-width: 0;
}

/* Final override: enforce tan style for notes answer box */
.docs-controls #notesAnswerBox,
.docs-answers #notesAnswerBox {
  background: var(--paper-panel-opaque) !important;
  border: 1px solid var(--paper-border) !important;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
}

/* --- Right Sidebar: small blue circle bullets for each entry --- */
#patientRightSidebar .vital-reads { list-style: none; padding: 0; margin: 0; }
#patientRightSidebar .vital-reads li { position: relative; padding-left: 14px; margin: 4px 0; }
#patientRightSidebar .vital-reads li::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0.9em;
  width: 6px;
  height: 6px;
  background: var(--brand-blue);
  border-radius: 50%;
  transform: translateY(-50%);
}

/* Hover preview for citations: non-blocking, sized, clamped */
.qa-cite-popover {
  pointer-events: none !important;          /* do not block clicks on links underneath */
  max-width: 460px !important;
  max-height: 12em !important;              /* ~8 lines at 1.5 line-height */
  overflow: hidden !important;
  white-space: normal !important;           /* allow wrapping so clamp works */
  display: -webkit-box !important;
  line-clamp: 8;                     /* standard property for compatibility */
  -webkit-line-clamp: 8;                    /* clamp to N lines */
  -webkit-box-orient: vertical;
  mask-image: linear-gradient(180deg, #000 80%, rgba(0,0,0,0)); /* subtle fade-out */
}

/* Optional: small fade-in to reduce abruptness */
.qa-cite-popover {
  opacity: 0; transform: translateY(2px);
  transition: opacity 120ms ease, transform 120ms ease;
}
.qa-cite-popover.qa-cite-popover--show {
  opacity: 1; transform: translateY(0);
}

/* Hey OMAR mic button styles */
.btn-mic {
  background: transparent !important;
  border: none !important;  /* ensure no border from global button styles */
  padding: 0;
  margin-left: 6px;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  position: relative; /* allow overlay */
}
.btn-mic .hey-omar-img {
  height: 40px; /* larger icon */
  width: auto;
  display: block;
  position: relative;
  z-index: 1; /* under overlay */
}
.btn-mic:hover .hey-omar-img { filter: drop-shadow(0 1px 1.5px rgba(0,0,0,0.25)); }
.btn-mic:active .hey-omar-img { transform: translateY(1px); filter: drop-shadow(0 0 0 rgba(0,0,0,0)) brightness(0.95); }

/* Pulsating blue glow overlay for Hey OMAR button (same inset and radius as record) */
.btn-mic::after {
  content: "";
  position: absolute;
  inset: 10%;                 /* match record overlay sizing */
  border-radius: 50%;
  pointer-events: none;
  z-index: 2;                /* above the image */
  opacity: 0;                /* show only when active */
  box-shadow:
    0 0 var(--ask-glow, 24px) rgba(37, 99, 235, 0.45),
    0 0 calc(var(--ask-glow, 24px) * 1.6) rgba(37, 99, 235, 0.25),
    inset 0 0 calc(var(--ask-glow, 24px) * 0.4) rgba(37, 99, 235, 0.18);
  transition: opacity 120ms ease;
}
.btn-mic.mic-active::after {
  opacity: 1;
  animation: askMicGlow 1.6s ease-in-out infinite;
}
@keyframes askMicGlow {
  0%, 100% {
    box-shadow:
      0 0 var(--ask-glow, 24px) rgba(37, 99, 235, 0.50),
      0 0 calc(var(--ask-glow, 24px) * 1.6) rgba(37, 99, 235, 0.30),
      inset 0 0 calc(var(--ask-glow, 24px) * 0.6) rgba(37, 99, 235, 0.26);
  }
  50% {
    box-shadow:
      0 0 calc(var(--ask-glow, 24px) * 1.3) rgba(37, 99, 235, 0.66),
      0 0 calc(var(--ask-glow, 24px) * 2.0) rgba(37, 99, 235, 0.38),
      inset 0 0 calc(var(--ask-glow, 24px) * 0.6) rgba(37, 99, 235, 0.26);
  }
}

/* While pressed, keep current gentle blue glow on the text input */
.notes-ask-inline.hold-active #notesAskInput { box-shadow: 0 0 0 3px rgba(37,99,235,0.25), 0 0 0 6px rgba(37,99,235,0.12); }

/* === Hey OMAR mic active pulsating glow (match record inset/radius) === */
#notesAskMicBtn { position: relative; }
#notesAskMicBtn img { position: relative; z-index: 1; }
#notesAskMicBtn::after {
  content: "";
  position: absolute;
  inset: 10%;                /* same inset as record overlay */
  border-radius: 50%;        /* circular glow like record */
  pointer-events: none;
  z-index: 2;                /* above image */
  opacity: 0;                /* only visible when active */
  box-shadow:
    0 0 var(--ask-glow, 0px) rgba(52, 152, 219, 0.85),
    0 0 calc(var(--ask-glow, 0px) * 2.4) rgba(52, 152, 219, 0.45),
    inset 0 0 calc(var(--ask-glow, 0px) * 0.6) rgba(52, 152, 219, 0.35);
  transition: opacity 120ms ease;
}
#notesAskMicBtn.mic-active::after {
  opacity: 1;
  animation: askMicPulse 1.6s ease-in-out infinite;
}
@keyframes askMicPulse {
  0% {
    box-shadow:
      0 0 0px rgba(52, 152, 219, 0.0),
      0 0 0px rgba(52, 152, 219, 0.0),
      inset 0 0 0px rgba(52, 152, 219, 0.0);
  }
  50% {
    box-shadow:
      0 0 var(--ask-glow, 24px) rgba(52, 152, 219, 0.85),
      0 0 calc(var(--ask-glow, 24px) * 2.4) rgba(52, 152, 219, 0.45),
      inset 0 0 calc(var(--ask-glow, 24px) * 0.6) rgba(52, 152, 219, 0.35);
  }
  100% {
    box-shadow:
      0 0 0px rgba(52, 152, 219, 0.0),
      0 0 0px rgba(52, 152, 219, 0.0),
      inset 0 0 0px rgba(52, 152, 219, 0.0);
  }
}

/* === Mobile segmented wheel picker + swipe views === */
#mobilePicker { margin: 8px 10px 0 10px; }
.segmented-scroll {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none; /* Firefox */
  padding: 6px 2px 6px 2px;
}
.segmented-scroll::-webkit-scrollbar { display: none; } /* WebKit */
.seg-btn {
  flex: 0 0 auto;
  padding: 8px 14px;
  border-radius: 999px;
  border: 1px solid var(--paper-border);
  background: var(--paper-panel);
  color: var(--paper-contrast);
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 1px 2px rgba(0,0,0,0.06);
}
.seg-btn:hover { background: color-mix(in srgb, var(--brand-blue) 6%, var(--paper-panel)); }
.seg-btn.active {
  background: var(--brand-blue);
  color: #fff;
  border-color: var(--brand-blue-dark);
}

/* Responsive improvements for very narrow screens */
@media (max-width: 480px) {
  .seg-btn {
    padding: 6px 10px;
    font-size: 13px;
    min-width: 60px;
  }
  
  #mobilePicker {
    margin: 6px 8px 0 8px;
  }
  
  .segmented-scroll {
    gap: 4px;
    padding: 4px 2px;
  }
}

@media (max-width: 360px) {
  .seg-btn {
    padding: 4px 6px;
    font-size: 11px;
    min-width: 45px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 80px;
  }
  
  .segmented-scroll {
    gap: 2px;
    padding: 4px 1px;
  }
  
  #mobilePicker {
    margin: 4px 6px 0 6px;
  }
}

/* Views container */
#mobileContent { margin: 10px 8px 12px 8px; }
.mobile-views-wrap { position: relative; overflow: visible; border: 1px solid var(--paper-border); border-radius: 10px; background: var(--paper-panel); }
.mobile-views-track { display: flex; width: 100%; transition: transform 260ms ease; }
.mobile-view { flex: 0 0 100%; width: 100%; padding: 14px 16px; min-height: auto; box-sizing: border-box; }
.mobile-view-title { margin: 0 0 6px 0; font-size: 1.1em; color: var(--brand-blue); }
.mobile-view-desc { margin: 0; color: var(--paper-contrast); opacity: 0.9; }

/* --- To Do Module Styles --- */
.todo-module { display: flex; flex-direction: column; gap: 10px; height: 100%; }
.todo-module .module-header { display:flex; align-items:center; justify-content: space-between; gap: 8px; }
.todo-module .todo-controls { display:flex; align-items:center; gap:8px; }
.todo-module .todo-controls select { margin: 0; padding: 6px 10px; height: 32px; font-size: 0.95em; }
.todo-module .todo-controls .refresh-btn { height: 32px; padding: 0 10px; }
.todo-module .todo-content { display:block; }
.todo-module .todo-group { border: 1px solid var(--paper-border, #ddd); border-radius: 8px; background:#fff; margin: 8px 0; }
.todo-module .todo-group > summary { list-style: none; cursor: pointer; padding: 8px 12px; border-bottom: 1px solid var(--paper-border, #eee); display:flex; align-items:center; gap:8px; }
.todo-module .todo-group > summary::-webkit-details-marker { display:none; }
.todo-module .todo-group > summary .badge { background: #e6f2ff; color: #1f5fbf; border: 1px solid #c7dfff; padding: 2px 8px; border-radius: 10px; font-size: 0.85em; }
.todo-module ul.vital-reads { margin: 0; padding: 6px 10px 10px 18px; }
.todo-module .todo-order { list-style: none; padding: 10px 8px; margin: 0; border-bottom: 1px dashed #eee; border-radius: 6px; transition: background-color .12s ease; }
.todo-module .todo-order:last-child { border-bottom: none; }
.todo-module .todo-order:hover, .todo-module .todo-order:focus { background: #fafafa; outline: none; }
.todo-module .todo-order-top { display:flex; align-items:center; justify-content: space-between; gap: 12px; }
.todo-module .todo-order-main { display:flex; align-items:center; gap: 8px; min-width: 0; }
.todo-module .todo-order-date { font-size: 0.9em; color:#666; }
.todo-module .todo-order-name { font-weight: 600; color:#333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 46vw; }
.todo-module .todo-order-status .status-chip { background:#f0f0f5; border:1px solid #ddd; color:#444; padding:2px 8px; border-radius: 10px; font-size: 0.85em; white-space: nowrap; }
.todo-module .todo-order-details { padding: 8px 12px 2px 12px; color:#444; }
.todo-module .todo-detail-row { font-size: 0.95em; padding: 3px 0; }

/* Checklist styles */
.todo-module .checklist-section {
  margin-bottom: 20px;
  border: 1px solid var(--paper-border, #ddd);
  border-radius: 8px;
  background: #fff;
}

.todo-module .checklist-header {
  padding: 12px 16px;
  border-bottom: 1px solid var(--paper-border, #eee);
  background: #f8f9fa;
  border-radius: 8px 8px 0 0;
}

.todo-module .checklist-header h4 {
  margin: 0;
  font-size: 1em;
  font-weight: 600;
  color: #333;
}

.todo-module .checklist-container {
  padding: 12px;
  min-height: 60px;
}

.todo-module .checklist-empty {
  text-align: center;
  color: #666;
  font-style: italic;
  padding: 20px;
}

.todo-module .checklist-list {
  list-style: none;
  margin: 0;
  padding: 0;
}

.todo-module .checklist-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  margin: 4px 0;
  border: 1px solid #eee;
  border-radius: 6px;
  background: #fdfdfd;
  transition: all 0.15s ease;
  cursor: grab;
}

.todo-module .checklist-item:hover {
  background: #f5f5f5;
  border-color: #ddd;
}

.todo-module .checklist-item.dragging {
  opacity: 0.5;
  cursor: grabbing;
}

.todo-module .checklist-item.drag-over-top {
  border-top: 2px solid #4a90e2;
}

.todo-module .checklist-item.drag-over-bottom {
  border-bottom: 2px solid #4a90e2;
}

.todo-module .checklist-drag-handle {
  color: #999;
  cursor: grab;
  font-size: 0.9em;
  line-height: 1;
  user-select: none;
}

.todo-module .checklist-drag-handle:hover {
  color: #666;
}

.todo-module .checklist-checkbox {
  margin: 0;
  cursor: pointer;
}

.todo-module .checklist-text {
  flex: 1;
  padding: 2px 4px;
  border: 1px solid transparent;
  border-radius: 3px;
  background: transparent;
  transition: all 0.15s ease;
  cursor: text;
  word-wrap: break-word;
  min-height: 1.2em;
}

.todo-module .checklist-text:hover {
  background: #f8f8f8;
  border-color: #e0e0e0;
}

.todo-module .checklist-text:focus {
  outline: none;
  background: #fff;
  border-color: #4a90e2;
  box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
}

.todo-module .checklist-text.completed {
  text-decoration: line-through;
  color: #888;
  opacity: 0.7;
}

.todo-module .checklist-delete {
  background: none;
  border: none;
  color: #999;
  cursor: pointer;
  font-size: 1.2em;
  line-height: 1;
  padding: 2px 4px;
  border-radius: 3px;
  transition: all 0.15s ease;
}

.todo-module .checklist-delete:hover {
  background: #ff4444;
  color: white;
}

.todo-module .checklist-add {
  display: flex;
  gap: 8px;
  padding: 12px;
  border-top: 1px solid var(--paper-border, #eee);
  background: #f8f9fa;
  border-radius: 0 0 8px 8px;
}

.todo-module .checklist-input {
  flex: 1;
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 0.95em;
}

.todo-module .checklist-input:focus {
  outline: none;
  border-color: #4a90e2;
  box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
}

.todo-module .checklist-add-button {
  padding: 8px 16px;
  background: #4a90e2;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 0.95em;
  cursor: pointer;
  transition: background-color 0.15s ease;
}

.todo-module .checklist-add-button:hover {
  background: #357abd;
}

.todo-module .checklist-add-button:active {
  background: #2968a3;
}

.todo-module .orders-section {
  margin-top: 20px;
}

.todo-module .orders-header {
  margin-bottom: 12px;
}

.todo-module .orders-header h4 {
  margin: 0;
  font-size: 1em;
  font-weight: 600;
  color: #333;
}

/* screen-reader only helper */
.sr-only { position:absolute; left:-10000px; top:auto; width:1px; height:1px; overflow:hidden; }

/* Orders module styles */
.orders-module .status-pill{ display:inline-block; padding:2px 6px; border-radius:10px; background:#eef; color:#334; font-size:12px; }
.orders-module .orders-details .detail-header{ font-size:14px; }
.orders-module .orders-details hr{ border:none; border-top:1px solid #eee; margin:6px 0; }

/* Orders module: ensure table area gets clicks and sits above accidental overlays */
.orders-module .orders-table-container { position: relative; z-index: 3; pointer-events: auto; }
.orders-module #ordersTable, .orders-module .tabulator { pointer-events: auto; }

/* Documents: Title picker and highlighting */
.title-filter-btn{
  margin-left: 6px;
  font-size: 12px;
  line-height: 1;
  padding: 2px 6px;
  border: 1px solid var(--paper-border);
  background: #fff;
  border-radius: 4px;
  cursor: pointer;
}
.title-filter-btn:hover{ background:#f5f5f5; }
.title-filter-btn.title-picker-active{ background: var(--paper-accent, #4a90e2); color:white; border-color: var(--paper-accent, #4a90e2); }

.title-picker-dropdown{
  font-size: 13px;
  color: #222;
}
.title-picker-header{ font-weight: 600; }
.title-picker-item{ padding: 3px 0; }
.title-picker-list{ max-height: 280px; overflow: auto; }
.title-picker-toggle{ padding: 2px 8px; border:1px solid var(--paper-border); background:#fff; border-radius: 4px; cursor:pointer; }

/* Highlighted document rows when in Highlight mode */
.tabulator-row.doc-title-highlighted{
  background: rgba(255, 235, 59, 0.25) !important; /* soft yellow */
}

/* Compact rows and smaller font to show more rows */
#documentsTable .tabulator-row, .doc-table .tabulator-row{
  font-size: 15px;
  line-height: 1.25;
}
#documentsTable .tabulator-cell, .doc-table .tabulator-cell{ padding-top: 2px; padding-bottom: 2px; }

/* Expand documents table/viewer area with modest margins inside panels */
#documentsPanel .doc-table-wrap{ margin: 8px; }
#documentsPanel .doc-viewer-overlay{ margin: 8px; }

/* Active state on header cell when title filter is active */
.tabulator-col.title-picker-active{ outline: 2px solid var(--paper-accent, #4a90e2); outline-offset: -2px; }

/* Documents table: bold note titles */
#documentsTable .tabulator-cell.doc-title-cell { font-weight: 700; }

/* --- Mobile Shell Styles --- */
.mobile-shell {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  background: var(--paper-background);
  overflow: visible;
  min-width: 280px; /* Prevent complete collapse */
}

.mobile-shell #mobileTopBar {
  flex-shrink: 0;
  position: relative;
  z-index: 100;
}

.mobile-shell .mobile-top-bar {
  background: var(--color-primary);
  color: white;
  padding: 8px 12px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  min-height: 48px;
  box-sizing: border-box;
}

.mobile-shell #mobileRowButtons {
  flex-shrink: 0;
  z-index: 90;
}

.mobile-shell #notesAskVoiceStatus {
  flex-shrink: 0;
  font-size: 12px;
  color: #666;
  text-align: center;
  padding: 2px 8px;
  min-height: 16px;
}

.mobile-shell #mobilePicker {
  flex-shrink: 0;
  background: var(--paper-panel);
  border-bottom: 1px solid var(--paper-border);
  padding: 8px 0;
  z-index: 80;
  min-height: 40px;
  overflow: visible;
}

.mobile-shell #mobileContent {
  flex: 1;
  overflow: visible;
  display: flex;
  flex-direction: column;
  min-height: auto;
}

/* --- Mobile Workspace-specific Styles --- */
.page-workspace.mobile .mobile-view {
  display: flex;
  flex-direction: column;
  min-height: auto;
}

.page-workspace.mobile .mobile-view-header {
  flex-shrink: 0;
  padding: 8px 12px;
  border-bottom: 1px solid var(--paper-border);
  background: #f8f9fa;
}

.page-workspace.mobile .mobile-view-title {
  margin: 0;
  font-size: 1.1em;
  font-weight: 600;
  color: var(--brand-blue);
}

.page-workspace.mobile .module-container {
  flex: none;
  overflow-y: visible;
  display: flex;
  flex-direction: column;
  min-height: auto;
}

.page-workspace.mobile .module-loading,
.page-workspace.mobile .module-error {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
  text-align: center;
  color: #666;
}

.page-workspace.mobile .module-error {
  color: #d32f2f;
  background-color: #ffebee;
  border: 1px solid #ffcdd2;
  border-radius: 8px;
  margin: 20px;
}

/* Workspace module adaptations for mobile */
.page-workspace.mobile .module-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--paper-border);
}

.page-workspace.mobile .module-header h3 {
  margin: 0;
  font-size: 1em;
  color: var(--paper-contrast);
}

.page-workspace.mobile .refresh-btn,
.page-workspace.mobile .save-btn,
.page-workspace.mobile .clear-btn {
  padding: 8px 12px;
  font-size: 14px;
  border-radius: 6px;
  border: 1px solid var(--paper-border);
  background: var(--paper-panel);
  cursor: pointer;
  transition: all 0.2s ease;
}

.page-workspace.mobile .refresh-btn:hover {
  background: #e8eff5;
}

.page-workspace.mobile .save-btn {
  background: #4caf50;
  color: white;
  border-color: #4caf50;
}

.page-workspace.mobile .clear-btn {
  background: #f44336;
  color: white;
  border-color: #f44336;
}

/* Mobile-specific module styles */
.page-workspace.mobile .note-module textarea {
  width: 100%;
  min-height: 300px;
  padding: 12px;
  border: 1px solid var(--paper-border);
  border-radius: 8px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  font-size: 16px;
  resize: vertical;
}

.page-workspace.mobile .documents-module {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.page-workspace.mobile .documents-controls {
  flex-shrink: 0;
  padding: 12px;
  background: var(--paper-panel);
  border: 1px solid var(--paper-border);
  border-radius: 8px;
  margin-bottom: 8px;
}

.page-workspace.mobile .documents-table-container {
  flex: 1;
  overflow: hidden;
  border: 1px solid var(--paper-border);
  border-radius: 8px;
}

.page-workspace.mobile .vitals-module,
.page-workspace.mobile .labs-module {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.page-workspace.mobile .vitals-content,
.page-workspace.mobile .labs-content {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.page-workspace.mobile .vital-item,
.page-workspace.mobile .lab-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  background: var(--paper-panel);
  border: 1px solid var(--paper-border);
  border-radius: 8px;
}

.page-workspace.mobile .vital-item label,
.page-workspace.mobile .lab-item .lab-name {
  font-weight: 600;
  color: var(--paper-contrast);
}

.page-workspace.mobile .vital-value,
.page-workspace.mobile .lab-value {
  font-weight: bold;
  color: #1976d2;
}

.page-workspace.mobile .vital-date,
.page-workspace.mobile .lab-date {
  font-size: 12px;
  color: #666;
  margin-top: 4px;
}

/* Emphasize cancel state for Index Visible button */
.index-visible-btn.danger {
  background-color: #fff5f5 !important;
  color: #c53030 !important;
  border: 1px solid #feb2b2 !important;
}
.index-visible-btn.danger:hover,
.index-visible-btn.danger:focus {
  background-color: #fed7d7 !important;
  border-color: #fc8181 !important;
}
